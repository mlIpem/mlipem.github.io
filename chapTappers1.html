<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 7 Two finger tappers’ entrainment (Part 1) | Exploring music interactions</title>
<meta name="author" content="Marc Leman">
<meta name="description" content="This chapter is about mutual influences during music interaction. In the restricted context of finger tapping this influence can be formulated as follows: Would my own tapping be affected by...">
<meta name="generator" content="bookdown 0.41 with bs4_book()">
<meta property="og:title" content="Chapter 7 Two finger tappers’ entrainment (Part 1) | Exploring music interactions">
<meta property="og:type" content="book">
<meta property="og:url" content="https://www.ugent.be/chapTappers1.html">
<meta property="og:image" content="https://www.ugent.be/images/cover.jpeg">
<meta property="og:description" content="This chapter is about mutual influences during music interaction. In the restricted context of finger tapping this influence can be formulated as follows: Would my own tapping be affected by...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Chapter 7 Two finger tappers’ entrainment (Part 1) | Exploring music interactions">
<meta name="twitter:description" content="This chapter is about mutual influences during music interaction. In the restricted context of finger tapping this influence can be formulated as follows: Would my own tapping be affected by...">
<meta name="twitter:image" content="https://www.ugent.be/images/cover.jpeg">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><link href="libs/Lato-0.4.9/font.css" rel="stylesheet">
<link href="libs/Roboto_Mono-0.4.9/font.css" rel="stylesheet">
<link href="libs/Montserrat-0.4.9/font.css" rel="stylesheet">
<script src="libs/bs3compat-0.8.0/transition.js"></script><script src="libs/bs3compat-0.8.0/tabs.js"></script><script src="libs/bs3compat-0.8.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<link rel="icon" type="image/png" sizes="32x32" href="images/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="images/favicon-16x16.png">
<script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-99618359-1', 'auto');
      ga('send', 'pageview');

    </script><!-- Google tag (gtag.js) --><script async src="https://www.googletagmanager.com/gtag/js?id=G-CDTTJLM7N4"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-CDTTJLM7N4');
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><link rel="stylesheet" href="style/style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h2>
        <a href="index.html" title="">Exploring music interactions</a>
      </h2>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Welcome</a></li>
<li><a class="" href="preface.html">Preface</a></li>
<li><a class="" href="chapTheory.html"><span class="header-section-number">1</span> Theory</a></li>
<li><a class="" href="chapModelling.html"><span class="header-section-number">2</span> Modelling</a></li>
<li><a class="" href="chapListener.html"><span class="header-section-number">3</span> Listener appreciation</a></li>
<li><a class="" href="chapDancer.html"><span class="header-section-number">4</span> Dancer synchronization</a></li>
<li><a class="" href="chapViolinist.html"><span class="header-section-number">5</span> Violin player visual feedback</a></li>
<li><a class="" href="chapExoskeletons.html"><span class="header-section-number">6</span> Two violin players’ haptic feedback</a></li>
<li><a class="active" href="chapTappers1.html"><span class="header-section-number">7</span> Two finger tappers’ entrainment (Part 1)</a></li>
<li><a class="" href="chapTappers2.html"><span class="header-section-number">8</span> Two finger tappers’ entrainment (Part 2)</a></li>
<li><a class="" href="chapConclusion.html"><span class="header-section-number">9</span> Conclusion</a></li>
<li><a class="" href="references.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/mlIpem/ExploringMusicInteractionWithR">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="chapTappers1" class="section level1" number="7">
<h1>
<span class="header-section-number">7</span> Two finger tappers’ entrainment (Part 1)<a class="anchor" aria-label="anchor" href="#chapTappers1"><i class="fas fa-link"></i></a>
</h1>
<p>This chapter is about mutual influences during music interaction.
In the restricted context of finger tapping this influence can be formulated as follows:
Would my own tapping be affected by seeing another person tapping at a different speed?
And would the other person be influence by me?</p>
<p>To analyse data about two persons interacting this way, previous studies used methods such as cross-correlation, cross-recurrence analysis, quantification analysis, delay-coupled oscillators, among others<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;For a review, see Demos &amp;amp; Palmer, 2023. For an approach based on Kuramoto models, see Heggli et al., 2019).&lt;/p&gt;"><sup>26</sup></a>.</p>
<p>In this chapter, however, we explore the <em>state-space model</em>, a mathematical representation of a dynamic system allowing the description of an evolution of internal states over time. This discription is based on a state equation that defines the transition of states, for example by means of differential, or difference, equations. The internal states are linked to observations by means of an observation equation which would, for example, add some fluctuation noise to the states.
The internal states of a system containing two persons tapping, could represent the tapping frequency, tapping period, or tapping phase at any moment. Adding fluctuation noise at discrete tapping events would be due to human sensorimotor variability, giving rise to observations. Basically that state-space model offers a toolbox for studing such mutual influences in finger tapping interactions.</p>
<p>We’ll study this state-space model from two perspectives. Firstly, from model to observations, using defined parameters we solve the state equation and generate observations by adding noise.
Secondly, from observations to model, by estimating the parameters and solving a likelihood function based on the state-space model (state and observation equations).</p>
<p>To solve the likelihood equation, we use Stan<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;See &lt;a href="https://mc-stan.org" class="uri"&gt;https://mc-stan.org&lt;/a&gt;&lt;/p&gt;'><sup>27</sup></a>, a probabilistic programming language based on Markov chain Monte Carlo (MCMC) sampling algorithms. Note that Stan is also the engine beneath <code>brms</code>, the package used in previous chapters. Here we address that engine directly.</p>
<p>The code is contained in:</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/source.html">source</a></span><span class="op">(</span><span class="st">"Code/chapAll_00_Initialization.R"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/source.html">source</a></span><span class="op">(</span><span class="st">"Code/chapAll_01_Functions.R"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/source.html">source</a></span><span class="op">(</span><span class="st">"Code/chapTappers/chapTappers_02_DataPreparation.R"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/source.html">source</a></span><span class="op">(</span><span class="st">"Code/chapTappers/chapTappers_02_Simulation.R"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/source.html">source</a></span><span class="op">(</span><span class="st">"Code/chapTappers/chapTappers_03_DataPlotting.R"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/source.html">source</a></span><span class="op">(</span><span class="st">"Code/chapTappers/chapTappers_04_Modelling.R"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/source.html">source</a></span><span class="op">(</span><span class="st">"Code/chapTappers/chapTappers_05_ModelPlotting.R"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/source.html">source</a></span><span class="op">(</span><span class="st">"Code/chapTappers/chapTappers_06_Evaluation.R"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/source.html">source</a></span><span class="op">(</span><span class="st">"Code/chapTappers/chapTappers_07_EvaluationPlotting.R"</span><span class="op">)</span></span></code></pre></div>
<div id="theory-3" class="section level2" number="7.1">
<h2>
<span class="header-section-number">7.1</span> Theory<a class="anchor" aria-label="anchor" href="#theory-3"><i class="fas fa-link"></i></a>
</h2>
<p>The theoretical background for this chapter is based on two concepts: entrainment and dynamic systems.</p>
<div id="entrainment-1" class="section level3 unnumbered">
<h3>Entrainment<a class="anchor" aria-label="anchor" href="#entrainment-1"><i class="fas fa-link"></i></a>
</h3>
<p>First consider entrainment, or, more specifically, <em>rhythmic</em> entrainment.
It can be defined as adaptation of timing, due to influences of persons interacting with each other. The influence can occur via modalities of perception other than hearing, for example through seeing, or feeling (see chapter <a href="chapExoskeletons.html#chapExoskeletons">6</a>).</p>
<p>We believe that entrainment is a factor that facilitates self-augmented interactions (see chapter <a href="chapTheory.html#chapTheory">1</a>).
In that context, entrainment works as an <em>automatic</em> adapter of actions towards a joint goal. Hence it facilitaties the interaction. It is automatic in the sense that it relies on sensorimotor control mechanisms, which subjects are typically not aware off.
The power of entrainment is assumed to be considerable, probably even resulting in strong emotional effects. But this is not what we are dealing with here.</p>
<p>In demonstrating the near inevitability of entrainment under controlled circumstances, Rosso et al. (2024) created an ingenious paradigm based on conditions in which hearing and seeing inform our timing differently, that is, <em>incongruently.</em> Entrainment is here understood as a principle that tends to solve incongruent feedback from actions by changing the actions that originally caused the incongruent feedback. Consequently, the perceptions are no longer incongruent, or at least less incongruent. Entrainment thus drives incongruent perception to more congruent perception, via changes in actions. That’s what we are going to deal with. Actions are here understood as fingertapping actions whose control is largely unconscious control. And, as changes in timing are small, we should perhaps speak about micro-timing actions (synchrony with metronome), which occur under the umbrella of macro-timing actions (finger taps).</p>
</div>
<div id="dynamic-system" class="section level3 unnumbered">
<h3>Dynamic system<a class="anchor" aria-label="anchor" href="#dynamic-system"><i class="fas fa-link"></i></a>
</h3>
<p>Can we understand action change in terms of a dynamic system?
It sounds complicated because the details of action-perception mechanisms, or sensorimotor mechanisms, leading to entrainment are probably very specific in each individual, and far from known. So, how should we deal with this?</p>
<p>A <em>dynamic systems approach</em> assumes that the interaction is ruled by higher-level parameters that only matter for the observed interaction.
Accordingly, each unit involved in the interaction can be handled as a black box whose inputs and outputs can be measured, without knowing how the black box functions. A reduction to the underlying action-perception mechanisms is not necessary because the observed behavior can be globally described. In order words, reductionism is replaced by a more wholistic perspective. Ultimately, reductionism and wholism may be integrated if we know more of the mechanisms. And, after all, we have to assume some mechanism in the black box as well.
But let us see how far we get with the wholistic perspective and some assumed black box mechanisms of error corrrection.</p>
<p>We capture the dynamic system as a state-space model, with a <em>state equation</em> and an <em>observation equation</em>. In global terms, these equations can be stated as:</p>
<p><span class="math display">\[\begin{equation}
\begin{array}{rl}
x_t = f(x_{t-1}, w) &amp; \text{[state equation]} \\
y_t = h(x_t, v) &amp; \text{[observation equation]}
\end{array}
\label{eq:chapTappersEquationStateSpaceModel}
\end{equation}\]</span></p>
<p>In this formulation, observation <span class="math inline">\(y_t\)</span> is based on a particular function <span class="math inline">\(h\)</span>, of state <span class="math inline">\(x_t\)</span> and some observation noise <span class="math inline">\(v\)</span>. For example, this function could be <span class="math inline">\(x_t + v\)</span> when the observation is generated by the state plus a random number <span class="math inline">\(v\)</span> drawn from a normal distribution, representing fluctuation noise.
The state <span class="math inline">\(x_t\)</span> depends on a function <span class="math inline">\(f\)</span>, of the previous state <span class="math inline">\(x_{t-1}\)</span> and some system noise <span class="math inline">\(w\)</span>.
In the simplest case <span class="math inline">\(f\)</span> could be <span class="math inline">\(x_{t-1} + w\)</span>, with <span class="math inline">\(w\)</span> being a system related stochastic parameter, or a noise, but <span class="math inline">\(f\)</span> could also be a non-linear function, as in our approach.</p>
<p>A state could represent a time interval between taps and tics.
A new time interval is then based on the previous time interval and some system noise, making the new time interval shorter, or larger.
We will use <em>phase</em> (= time * <span class="math inline">\(2\pi\)</span>) because it allows us to stipulate that every tick or tap occurs at multiples of <span class="math inline">\(2\pi\)</span>, starting from <span class="math inline">\(0 [rad]\)</span>. Then, using a modulo <span class="math inline">\(2\pi\)</span> operator we can easily extract the timing situation between two successive tics and taps.
And given the fact that phase evolves with time we can always translate the phase value back to time (by simply dividing by <span class="math inline">\(2\pi\)</span>).</p>
<p>The state can also be considered a vector, with vector components representing different units.
That’s exactly what we need in order to model entrainment.
We go deeper into the mathematics of the state-space model.
But before we do that we need to know what exactly we want to model.</p>
</div>
<div id="drifting-metronomes" class="section level3 unnumbered">
<h3>Drifting metronomes<a class="anchor" aria-label="anchor" href="#drifting-metronomes"><i class="fas fa-link"></i></a>
</h3>
<p>The <em>drifting metronomes</em> paradigm, developed in (Rosso et al., 2021, 2023), is a peculiar experimental design to uncover entrainment, by controlling for incongruency. Here is how it works.</p>
<p>Two subjects engage in synchronized tapping while listening to a metronome through headphones. The metronomes are slightly detuned in tempo, so that their phase drifts. In particular, one metronome tics every 600 ms, while the other tics every 610 ms. Initially, the metronomes start ticking together (in-phase), but as time evolves, the tics become wider apart (out-phasing), eventually reaching an anti-phase state before their ticking comes closer in time again (in-phasing). When the cycle is completed, the metronomes have one tic exactly together. One complete outphasing and inphasing cycle takes <span class="math inline">\(36.6\)</span> seconds (<span class="math inline">\(= 600 * 610/ 10\)</span>). The subjects are asked to perform 10 such cycles in a row during one performance. They are instructed to follow the metronome they hear through the headphones.</p>
<p>The conditions of interest are: (i) not seeing each other and (ii) seeing each other.<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;Note that in the original experiment, there are 4 conditions. The two other conditions control the perspective of looking. Using VR, subjects saw their own arm ticking from a second perspective, or they saw the partner’s arm ticking as their own arm. However, here we don’t consider these perspective swapping conditions.&lt;/p&gt;"><sup>28</sup></a></p>
<p>Rosso et al. (2023) found that the subjects’ tapping behavior was influenced by seeing each other tapping, despite the instruction to follow their own metronome. In other words, visual coupling between the individuals led to an entrainment effect on tapping behavior, even if the task implied anti-entrainment (or resistence to entrainment). This suggests that incongruent visual cues from the partner’s tapping can be particularly strong, overriding the intended synchronization with the metronome they heard.</p>
<p>Our interest is to offer a causal explanation of this phenomenon. Our goal is to build a state-space model of entrainment, using a few control parameters that govern the causal flow among interacting units.</p>
</div>
<div id="causality" class="section level3 unnumbered">
<h3>Causality<a class="anchor" aria-label="anchor" href="#causality"><i class="fas fa-link"></i></a>
</h3>
<p>What is meant by <em>causal explanation</em>? The type of modelling suggests a <em>causal</em> level at which tapping/ticking is basically understood in terms of a limited number of parameters that control a phase flow among the units. All the knowledge is in the dynamics of this phase flow and we don’t need to go deeper into the subcomponents of our interacting units. Conceptually speaking, this approach is very different from smooth regression, where modelling is based on a basis expansion using many parameters for splines (see previous chapters). The associated parameters don’t model a flow, they just expand the space for the data.</p>
<p>What we want to model is a dynamics that pops up from the action-perception mechanisms that control the timing of the interacting units (subjects and metronomes). This dynamics is described at that higher level in which the parameters control the phase flow among those units. The parameters form part of the state equation, which describes how the internal states are propagated. That equation captures our belief of how the system works. In addition we have another parameter which links this state to the observation.</p>
<p>As we cannot measure the parameters directly we have to infer them from the observations.</p>
</div>
<div id="approach-in-this-chapter" class="section level3 unnumbered">
<h3>Approach in this chapter<a class="anchor" aria-label="anchor" href="#approach-in-this-chapter"><i class="fas fa-link"></i></a>
</h3>
<p>The development of the state-space model implies several steps which we summarize in figure <a href="chapTappers1.html#fig:chapTappers1framework">7.1</a>:</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:chapTappers1framework"></span>
<img src="Figures/chapTappers_AnalysisPlan.jpg" alt="Methodological approach (see text for explanation)" width="90%"><p class="caption">
Figure 7.1: Methodological approach (see text for explanation)
</p>
</div>
<ul>
<li><p>In step 1, we define the state-space model its parameters. With state equations we obtain the states, and with the observation equation we obtain the observations.</p></li>
<li><p>In step 2, we use simulated observations (from step 1) and feed them to the state-space model likelihood equation. The solution (via MCMC sampling) is a posterior distribution from which we retrieve parameters. We also calculate generated observations, called posterior predictions, and its estimated parameters.</p></li>
<li><p>In step 3, we check whether the defined parameters correspond to the estimated parameters. Moreover, we check whether states and observations of the defined model correspond to the states and observations generated of the fitted model.</p></li>
</ul>
</div>
</div>
<div id="step1.-from-model-to-observations" class="section level2" number="7.2">
<h2>
<span class="header-section-number">7.2</span> Step1. From model to observations<a class="anchor" aria-label="anchor" href="#step1.-from-model-to-observations"><i class="fas fa-link"></i></a>
</h2>
<div id="define-the-units" class="section level3 unnumbered">
<h3>Define the units<a class="anchor" aria-label="anchor" href="#define-the-units"><i class="fas fa-link"></i></a>
</h3>
<p>First we define the dynamic system.
It contains four units, whose interaction is described by arrows, as shown in figure <a href="chapTappers1.html#fig:chapTappers2ODEsystem">7.2</a>.</p>
<p>Metronome 1, subject 1, metronome 2 and subject 2 are represented by units <span class="math inline">\(m1,s1,m2\)</span> and <span class="math inline">\(s2\)</span> and
their coupling is represented by arrows pointing from one unit to another unit. An arrow from <span class="math inline">\(s1\)</span> pointing to <span class="math inline">\(m1\)</span> means that subject 1 is coupled to metronome 1, which is described by a combination of coupling strength and phase delay.
The arrows show that subjects are coupled to the own metronome, and to the other subject.</p>
<p>We follow the convention that the arrows point in the direction where the influence comes from.
Accordingly, each subject points to the own metronome and to the other subject.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:chapTappers2ODEsystem"></span>
<img src="Figures/chapTappers_odepredictor.jpg" alt="Dynamic system" width="75%"><p class="caption">
Figure 7.2: Dynamic system
</p>
</div>
</div>
<div id="coupling-parameters" class="section level3 unnumbered">
<h3>Coupling parameters<a class="anchor" aria-label="anchor" href="#coupling-parameters"><i class="fas fa-link"></i></a>
</h3>
<p>Each arrow is defined by two parameters, called <em>coupling strength</em> and <em>phase delay</em>.</p>
<p>The <em>coupling strength</em> has the prefix <span class="math inline">\(k\)</span> and its value ranges from 0 to 1. A value of 0 indicates no coupling, or no phase flow, and a value of 1 indicates full coupling, or full phase flow. The coupling strength <span class="math inline">\(ks1m1\)</span> captures how strongly <span class="math inline">\(s1\)</span> adheres to the phase of <span class="math inline">\(m1\)</span> and thus, how strongly <span class="math inline">\(m1\)</span> is affecting the tapping of <span class="math inline">\(s1\)</span>.</p>
<p>A very important feature of this model is that the coupling parameters always sum to <span class="math inline">\(1\)</span>. In other words: <span class="math inline">\(1 = ks1m1 + ks1s2\)</span> and <span class="math inline">\(1 = ks2m2 + ks2s1\)</span>. This constraint ensures competition among phase flows to metronome and partner. In other words, each subject has a constant volume of phase flow with metronome and partner. However, the gate that controls the phase flow of the own metronome competes with the gate that controls the phase flow gate of the partner. If the gate to the metronome is fully open, then the gate to the partner will be fully closed. The sum is always 1.</p>
<p>The coupling strength can be represented by the length of the arrows, as suggested in figure <a href="chapTappers1.html#fig:chapTappers2ODEsystem2">7.3</a>.
In the left block the subjects devote all attention to their own metronome (<span class="math inline">\(ks1m1 = ks2m2 = 1\)</span>). It would be a typical situation where subjects <em>hear</em> the metronome and <em>don’t see</em> each other.
In the right block, the subjects divide attention partly to the metronome, partly to the partner.
It would be a typical situation where subjects <em>hear</em> the metronome and <em>see</em> each other.
The figure suggests that <span class="math inline">\(s1\)</span> has more attention to the own metronome than to the partner (say, <span class="math inline">\(ks1m1 = .7\)</span> and <span class="math inline">\(ks1s2 = 1-.7 =.3\)</span>), while <span class="math inline">\(s2\)</span> has more attention to the partner than to the metronome (say, <span class="math inline">\(ks2m2 = .3\)</span> and <span class="math inline">\(ks2s1 = 1-.3 = .7\)</span>).</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:chapTappers2ODEsystem2"></span>
<img src="Figures/chapTappers_odesystem2parts.jpg" alt="Assumed coupling strength parameters of the uncoupled and coupled condition" width="100%"><p class="caption">
Figure 7.3: Assumed coupling strength parameters of the uncoupled and coupled condition
</p>
</div>
<p>The <em>phase delay</em> has the prefix <span class="math inline">\(d\)</span> (figure <a href="chapTappers1.html#fig:chapTappers2ODEsystem">7.2</a>) and its value ranges from <span class="math inline">\(-\pi\)</span> to <span class="math inline">\(\pi\)</span>.
<!-- $-\frac{\pi}{2}$ to $\frac{\pi}{2}$.  -->
It specifies an average synchronization offset over the entire outphasing-inphasing cycle.
The phase delay could be deleted from the model but introducing it gives more flexibility to the model.</p>
</div>
<div id="state-equations" class="section level3 unnumbered">
<h3>State equations<a class="anchor" aria-label="anchor" href="#state-equations"><i class="fas fa-link"></i></a>
</h3>
<p>The state equations fully describe the phase flow, that is, how phase values of interconnected units <span class="math inline">\({m1,s1,m2,s2}\)</span> change over time. The observation equation describes how observations relate to states. Typically, the relationship caputures the distinction between discrete observations and continuous states. In addition, it captures a fluctuation property, an inpredictable uncertainty leading to small deviations from predictions.</p>
<p>Let us look in more detail at the state changes.
First consider metronomes, then subjects.</p>
<p>The state of the metronomes <span class="math inline">\(m1\)</span> and <span class="math inline">\(m2\)</span> at a particular time can be notated as <span class="math inline">\({\theta}_{m1,t}\)</span> and <span class="math inline">\({\theta}_{m2,t}\)</span>. It is simply the phase of <span class="math inline">\(m1\)</span>, or <span class="math inline">\(m2\)</span>, at time <span class="math inline">\(t\)</span>.
The change of state (or phase change) over time is notated as <span class="math inline">\(\dot\theta\)</span>, or in a different notation, <span class="math inline">\(\frac{d\theta}{dt}\)</span>.</p>
<p>But how do we get the phase?
Well, metronomes tic at their own frequency, called the <em>eigen-frequency</em>, which is given in units of radians per second <span class="math inline">\([\frac{rad}{sec}]\)</span>.
The discrete tic events of <span class="math inline">\(m1\)</span>, every <span class="math inline">\(.6\)</span> second, are turned into a continuously increasing phase cycle running <span class="math inline">\(2\pi\)</span> radians every <span class="math inline">\(.6\)</span> second. Similarly, <span class="math inline">\(m2\)</span> does its phase cycle in <span class="math inline">\(.61\)</span> seconds.</p>
<p>In short, metronome tics occur at <span class="math inline">\(2\pi\)</span> but this happens at a different speed, due to a different <em>eigen-frequency</em>.
Metronomes have a fixed phase cycle because there are no influences acting upon them. The system equations show that the continuous change in metronomes is constant.</p>
<p><span class="math display">\[
\begin{aligned}
\dot{\theta}_{m1} &amp;= \omega_{m1} = \frac{2\pi}{0.6} \\
\dot{\theta}_{m2} &amp;= \omega_{m2} = \frac{2\pi}{0.61}
\end{aligned}
\]</span></p>
<p>Or expressed as difference equation we have:</p>
<p><span class="math display">\[
\begin{aligned}
\theta_{m1,t} &amp;= \theta_{m1,t-1} + \frac{2\pi}{0.6} \Delta t \\
\theta_{m2,t} &amp;= \theta_{m2,t-1} + \frac{2\pi}{0.61} \Delta t
\end{aligned}
\]</span></p>
<p>This representation clearly says that the state at <span class="math inline">\(t\)</span> depends on the state at <span class="math inline">\(t-1\)</span> plus a constant depending on the time difference (<span class="math inline">\(\Delta{t}\)</span>) between <span class="math inline">\(t\)</span> and <span class="math inline">\(t-1\)</span>. The equation suggests that the phase <span class="math inline">\(\theta\)</span> is constantly increasing over time.</p>
<p>The state transition in subjects is a bit more demanding, due to influences.
The state equations for <span class="math inline">\(s1\)</span> and <span class="math inline">\(s2\)</span>, formulated as differential equations, are:</p>
<p><span class="math display" id="eq:chapTappersequation1a">\[\begin{equation}
\begin{array}{rl}
\dot{\theta}_{s1} = &amp; \omega_{m1} + \\
&amp; ks1m1 \cdot sin(\theta_{m1} - \theta_{s1} + ds1m1) + \\
&amp; (1-ks1m1) \cdot sin(\theta_{s2} - \theta_{s1} + ds1s2)\\
\end{array}\\
\begin{array}{rl}
\dot{\theta}_{s2} = &amp; \omega_{m2} + \\
&amp; ks2m2 \cdot sin(\theta_{m2} - \theta_{s2} + ds2m2) +\\
&amp; (1-ks2m2) \cdot sin(\theta_{s1} - \theta_{s2} + ds2s1)\\
\end{array}
\tag{7.1}
\end{equation}\]</span></p>
<p>Let us focus on <span class="math inline">\(s1\)</span>.
The subject is requested to follow <span class="math inline">\(m1\)</span> and therefore its eigen-frequency is set equal to the eigen-frequency of the metronome <span class="math inline">\(m1\)</span> (<span class="math inline">\(\omega_{m1}\)</span>).</p>
<ul>
<li><p>When the subject is devoting all attention to <span class="math inline">\(m1\)</span>, then <span class="math inline">\(ks1m1 = 1\)</span> and there will be zero contribution from the third term on the right hand side of the equation. In following the metronome, there might be deviations corrected by the error term <span class="math inline">\(sin(\theta_{m1} - \theta_{s1} + ds1m1)\)</span>.
However, note that the subject can tap in perfect synchrony with the metronome (when <span class="math inline">\(\theta_{m1} - \theta_{s1} = 0\)</span>), apart from a possible phase delay <span class="math inline">\(ds1m1\)</span>.</p></li>
<li><p>When the subject is devoting some attention to <span class="math inline">\(s2\)</span>,
then <span class="math inline">\(ks1m1 &lt; 1\)</span> and an external influence will be exerted in addition.</p></li>
</ul>
<p>Let’s expand on this influence. First, note that the terms two and three in the state equation are genuine error terms.
To better understand the contribution of these terms to the dynamics of the system, we will simplify the second term to:
<span class="math display">\[sin(\theta_{m1} - \theta_{s1})\]</span> or, in an even more simplified notation, we could write: <span class="math display">\[sin(\theta_{m1-s1}).\]</span>
It represents the phase error, or phase difference, between metronome 1 and subject 1.</p>
<p>We also keep in mind that in the first part of the outphasing-inphasing cycle, metronomes start ticking together but they start defasing immediately because <span class="math inline">\(m2\)</span> is ticking slower than <span class="math inline">\(m1\)</span>.</p>
<p>Given this context, <span class="math inline">\(sin(\theta_{m1-s1})\)</span> will be positive when the phase difference between metronome 1 and subject 1 (modulo <span class="math inline">\(2\pi\)</span>) is <span class="math inline">\(&lt;\pi\)</span>, reaching a maximum when <span class="math inline">\(\theta_{m1-s1} = \frac{\pi}{2}\)</span>, as <span class="math inline">\(sin(\frac{\pi}{2}) = 1\)</span>.
This might typically happen when <span class="math inline">\(s1\)</span> is retarded, for example, due to the influence of seeing <span class="math inline">\(s2\)</span> tapping slower.
The value will be negative when the phase difference (modulo <span class="math inline">\(2\pi\)</span>) is <span class="math inline">\(&gt;\pi\)</span>, reaching a minimum when <span class="math inline">\(\theta_{m1-s1} = \frac{3\pi}{2}\)</span>, as <span class="math inline">\(sin(\frac{3\pi}{2}) = -1\)</span>.
This might happen when the influence of seeing <span class="math inline">\(s2\)</span> is experienced as tapping ahead, due to an anti-phase effect.
Overall, this suggest that the error term evolves over time as a sinusoidal curve, first going up then going down, cross zero, going down and going up again.</p>
<p>Next, consider the third term, simplified as <span class="math display">\[sin(\theta_{s2-s1})\]</span>.
It represents the phase error between subject 2 and subject 1.</p>
<p>In the first part of the outphasing-inphasing cycle, <span class="math inline">\(s2\)</span> is tapping gradually slower than <span class="math inline">\(s1\)</span>. The phase of <span class="math inline">\(s1\)</span> will be higher than the phase of <span class="math inline">\(s2\)</span> so that the phase difference <span class="math inline">\(s2-s1\)</span> will be negative.
And as long as the phase difference (modulo <span class="math inline">\(2\pi\)</span>) is <span class="math inline">\(&gt; \pi\)</span>, <span class="math inline">\(sin(\theta_{s2-s1})\)</span> will be negative with a minimum at <span class="math inline">\(\theta_{s2-s1} = \frac{\pi}{2}\)</span>. This situation typically occurs at the beginning of the sequence.
However, when the phase difference (modulo <span class="math inline">\(2\pi\)</span>) turns positive <span class="math inline">\(&lt; \pi\)</span>, <span class="math inline">\(sin(\theta_{s2-s1})\)</span> will be positive with a maximum at <span class="math inline">\(\theta_{s2-s1} = \frac{3\pi}{2}\)</span>. This happens again due to an anti-phase effect.
Overall, the error term evolves over time as a sinusoidal curve, first going down then going up, cross zero, going up and going down again.</p>
<p>Note that <span class="math inline">\(m1\)</span> and <span class="math inline">\(s2\)</span> pull in opposite directions and the global resulting error term is a sum of these error terms, weighted by <span class="math inline">\(km1s1\)</span> and its reverse <span class="math inline">\(1 - km1s1\)</span>, respectively.</p>
<p>Due to the response to <span class="math inline">\(s2\)</span>, one may expect that, typically, the anti-phase zero-crossing point of subjects tapping will be delayed in the second error term. This delay is more pronounced in <span class="math inline">\(s2\)</span> than in <span class="math inline">\(m1\)</span>. The more the tapping slows down, the later that zero-crossing point will occur in the global error curve.</p>
<p>Since both sinusoids add, the curve will become asymmetrical both in time and in amplitude. And don’t forget that <span class="math inline">\(sin(.)\)</span> is first multiplied by the coupling strength.
With extreme parameter settings (e.g., <span class="math inline">\(ks1m1\)</span> &lt; .4) the zero-crossing effect disappears (see the examples below).</p>
<p>Finally, we also have to consider the effect of the phase delay parameters.
Since these parameters are held constant over the entire outphasing-inphasing cycle, they affect the entire curve by a shift of all values.
This effect is also best illustrated by means of examples shown below.</p>
<p>The state equations for subjects can be written either as differential or difference equation.
Here we consider a concise notation for <span class="math inline">\(s1\)</span>:</p>
<p><span class="math display">\[
\begin{aligned}
\dot{\theta}_{s1} &amp;= \omega_{m1} + (\epsilon_{m1-s1} + \epsilon_{s2-s1}) \\
\theta_{s1,t} &amp;= \theta_{s1,t-1} + (\omega_{m1} + \epsilon_{m1-s1} + \epsilon_{s2-s1}) \Delta t
\end{aligned}
\]</span></p>
<p>The first equation (differential) clearly shows the error term as <span class="math inline">\(\epsilon_{m1-s1}+\epsilon_{s2-s1}\)</span>. The second equation (difference) clearly shows that <span class="math inline">\(\theta\)</span> of <span class="math inline">\(s1\)</span> at <span class="math inline">\(t\)</span> is equal to <span class="math inline">\(\theta\)</span> of <span class="math inline">\(s1\)</span> at <span class="math inline">\(t-1\)</span> plus a term that contains a fraction (<span class="math inline">\(\Delta{t}\)</span>) of the eigen-frequency <span class="math inline">\(\omega\)</span> of <span class="math inline">\(m1\)</span> plus the error terms. The eigen-frequency is always positive and large compared to the error terms. Hence, the phase will continue to increase. Note that the error terms also include some system noise in coupling strength (<span class="math inline">\(k\)</span>) and phase delay (<span class="math inline">\(d\)</span>) parameters.</p>
<p>The state equation governs the state transitions of the dynamic system.
State equations thus propagate the states.
With four units in the dynamic system, we have four states that need to be propagated at each time instance.
Accordingly, the state vector at <span class="math inline">\(t\)</span> is</p>
<p><span class="math display">\[
\boldsymbol{\theta}_t = &lt;\theta_{m1,t}, \theta_{s1,t}, \theta_{m2,t}, \theta_{s2,t}&gt;
\]</span>.</p>
<p>and the state equation is:</p>
<p><span class="math display">\[
\boldsymbol{\theta}_t = \boldsymbol{\theta}_{t-1} +  (\boldsymbol\omega + \boldsymbol\epsilon)\Delta{t}
\]</span>
where <span class="math inline">\(\boldsymbol\omega\)</span> is a vector of eigen-frequencies and <span class="math inline">\(\boldsymbol\epsilon\)</span> is vector of an error terms. Clearly, for metronomes the error is always zero.</p>
<p>Then, finally, the observation <span class="math inline">\(O\)</span> is conceived as being based on the state <span class="math inline">\(\boldsymbol{\theta_{t}}\)</span>, plus an observation noise <span class="math inline">\(\textbf{v}\)</span>, where each component <span class="math inline">\(v\)</span> can be considered to have a normal distribution <span class="math inline">\(N(0,\textbf{V})\)</span> and thus we have:</p>
<p><span class="math display">\[
O_{t} = \boldsymbol{\theta_{t}} + \textbf{v}
\]</span>
where <span class="math inline">\(\textbf{v}\)</span> is distributed as a normal distribution with mean 0 and standard deviation <span class="math inline">\(V\)</span>: <span class="math inline">\(N(0,\textbf{V})\)</span>.
<span class="math inline">\(\textbf{V}\)</span> is a vector of standard deviations associated with the vector components of <span class="math inline">\(\boldsymbol{\theta_{t}}\)</span>.
It is zero for metronomes.
An observed tap of <span class="math inline">\(s1\)</span> at <span class="math inline">\(t\)</span> is equal to the state <span class="math inline">\(\theta_{s1,t}\)</span> plus a fluctuation noise.</p>
<p>Note that the equations of the metronomes could be deleted from our state-space representation as they are completely deterministic.
However, we prefer to include them in the specifications of the state-space model, mainly for future generalization purposes.</p>
</div>
<div id="understanding-the-dynamic" class="section level3 unnumbered">
<h3>Understanding the dynamic<a class="anchor" aria-label="anchor" href="#understanding-the-dynamic"><i class="fas fa-link"></i></a>
</h3>
<p>At this point it is instructive to calculate some states using the state equation.
First we define an R function called <code>dydt, which contains the state equation.</code></p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define dydt</span></span>
<span><span class="va">dydt</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">t</span>, <span class="va">y</span>, <span class="va">parms</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/with.html">with</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">as.list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">parms</span><span class="op">)</span><span class="op">)</span>, <span class="op">{</span></span>
<span>    <span class="co">############################## dynamic system</span></span>
<span>    <span class="va">dm1</span> <span class="op">=</span> <span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">*</span><span class="fl">1000</span><span class="op">/</span><span class="fl">600</span></span>
<span>    <span class="va">ds1</span> <span class="op">=</span> <span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">*</span><span class="fl">1000</span><span class="op">/</span><span class="fl">600</span>  <span class="op">+</span> </span>
<span>      <span class="fl">.5</span><span class="op">*</span><span class="op">(</span><span class="va">ks1m1</span><span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span><span class="op">(</span><span class="va">m1</span> <span class="op">-</span> <span class="va">s1</span> <span class="op">+</span> <span class="va">ds1m1</span><span class="op">)</span> <span class="op">+</span> </span>
<span>            <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">ks1m1</span><span class="op">)</span><span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span><span class="op">(</span><span class="va">s2</span> <span class="op">-</span> <span class="va">s1</span> <span class="op">+</span> <span class="va">ds1s2</span><span class="op">)</span> <span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">dm2</span> <span class="op">=</span> <span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">*</span><span class="fl">1000</span><span class="op">/</span><span class="fl">610</span></span>
<span>    <span class="va">ds2</span> <span class="op">=</span> <span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">*</span><span class="fl">1000</span><span class="op">/</span><span class="fl">610</span>  <span class="op">+</span> </span>
<span>      <span class="fl">.5</span><span class="op">*</span><span class="op">(</span><span class="va">ks2m2</span><span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span><span class="op">(</span><span class="va">m2</span> <span class="op">-</span> <span class="va">s2</span> <span class="op">+</span> <span class="va">ds2m2</span><span class="op">)</span> <span class="op">+</span> </span>
<span>            <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">ks2m2</span><span class="op">)</span><span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span><span class="op">(</span><span class="va">s1</span> <span class="op">-</span> <span class="va">s2</span> <span class="op">+</span> <span class="va">ds2s1</span><span class="op">)</span> <span class="op">)</span></span>
<span>    <span class="co">############################## retrieve components for ds1</span></span>
<span>    <span class="va">dem1s1</span> <span class="op">=</span> <span class="va">ks1m1</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span><span class="op">(</span><span class="va">m1</span> <span class="op">-</span> <span class="va">s1</span> <span class="op">+</span> <span class="va">ds1m1</span><span class="op">)</span></span>
<span>    <span class="va">des2s1</span> <span class="op">=</span> <span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">ks1m1</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span><span class="op">(</span><span class="va">s2</span> <span class="op">-</span> <span class="va">s1</span> <span class="op">+</span> <span class="va">ds1s2</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">dm1</span>,<span class="va">ds1</span>,<span class="va">dm2</span>,<span class="va">ds2</span>,<span class="va">dem1s1</span>,<span class="va">des2s1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>For didactic reasons, we also retrieve the error terms that contribute to <code>ds1</code> separately.
In fact, we re-calculate the error term <code>ks1m1* sin(m1 - s1 + ds1m1)</code> as <code>dem1s1</code> and the error term
(<code>1-ks1m1)* sin(s2 - s1 + ds1s2)</code> as <code>des2s1</code>.</p>
<p>We call upon this R-function to solve the equations numerically using the <code>ode</code>-function from the R-package <code>deSolve</code>, as shown in the code below.
But first we have to specify some parameters.
In particular, we set the coupling strength to <code>ks1m1 = .9, ks2m2 = .7</code>, while phase delays are zero.
The initial values of our states, which is at time <span class="math inline">\(0\)</span>, are all zero.
The states (<code>solution</code>) are then differentiated in order to obtain the instantaneous frequency from the phase.</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># define time points</span></span>
<span><span class="va">dt</span> <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">100</span></span>
<span><span class="va">time_points</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">36.6</span>, by <span class="op">=</span> <span class="va">dt</span><span class="op">)</span></span>
<span><span class="co"># define initial state</span></span>
<span><span class="va">state</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>m1 <span class="op">=</span> <span class="fl">0</span>, s1 <span class="op">=</span> <span class="fl">0</span>, m2 <span class="op">=</span> <span class="fl">0</span>, s2 <span class="op">=</span> <span class="fl">0</span>, em1s1 <span class="op">=</span> <span class="fl">0</span>, es2s1 <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="co"># define the parameters</span></span>
<span><span class="va">parm</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>ks1m1 <span class="op">=</span> <span class="fl">.9</span>, ks2m2 <span class="op">=</span> <span class="fl">.7</span>, ds1m1 <span class="op">=</span> <span class="fl">0</span>, ds2m2 <span class="op">=</span> <span class="fl">0</span>, ds1s2 <span class="op">=</span> <span class="fl">0</span>, ds2s1 <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="co"># solve the ODE</span></span>
<span><span class="va">solution</span> <span class="op">&lt;-</span> <span class="fu">ode</span><span class="op">(</span>y <span class="op">=</span> <span class="va">state</span>, times <span class="op">=</span> <span class="va">time_points</span>, func <span class="op">=</span> <span class="va">dydt</span>, parms <span class="op">=</span> <span class="va">parm</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># calculate the phase change over time = instantaneous frequency</span></span>
<span><span class="va">solution</span> <span class="op">&lt;-</span> <span class="va">solution</span> <span class="op">%&gt;%</span> <span class="fu">mutate</span><span class="op">(</span></span>
<span>  dm1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">NA</span>,<span class="fu"><a href="https://rdrr.io/r/base/diff.html">diff</a></span><span class="op">(</span><span class="va">m1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  ds1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">NA</span>,<span class="fu"><a href="https://rdrr.io/r/base/diff.html">diff</a></span><span class="op">(</span><span class="va">s1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  dm2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">NA</span>,<span class="fu"><a href="https://rdrr.io/r/base/diff.html">diff</a></span><span class="op">(</span><span class="va">m2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  ds2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">NA</span>,<span class="fu"><a href="https://rdrr.io/r/base/diff.html">diff</a></span><span class="op">(</span><span class="va">s2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  dm1s1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">NA</span>,<span class="fu"><a href="https://rdrr.io/r/base/diff.html">diff</a></span><span class="op">(</span><span class="va">em1s1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  ds2s1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">NA</span>,<span class="fu"><a href="https://rdrr.io/r/base/diff.html">diff</a></span><span class="op">(</span><span class="va">es2s1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Here is how the data frame <code>solution</code> looks like:</p>
<pre><code>## 'data.frame':    3661 obs. of  13 variables:
##  $ time : num  0 0.01 0.02 0.03 0.04 0.05 0.06 0.07 0.08 0.09 ...
##  $ m1   : num  0 0.105 0.209 0.314 0.419 ...
##  $ s1   : num  0 0.105 0.209 0.314 0.419 ...
##  $ m2   : num  0 0.103 0.206 0.309 0.412 ...
##  $ s2   : num  0 0.103 0.206 0.309 0.412 ...
##  $ em1s1: num  0.00 1.93e-09 1.15e-08 3.65e-08 8.34e-08 ...
##  $ es2s1: num  0.00 -8.58e-07 -3.43e-06 -7.71e-06 -1.37e-05 ...
##  $ dm1  : num  NA 0.105 0.105 0.105 0.105 ...
##  $ ds1  : num  NA 0.105 0.105 0.105 0.105 ...
##  $ dm2  : num  NA 0.103 0.103 0.103 0.103 ...
##  $ ds2  : num  NA 0.103 0.103 0.103 0.103 ...
##  $ dm1s1: num  NA 1.93e-09 9.61e-09 2.50e-08 4.69e-08 ...
##  $ ds2s1: num  NA -8.58e-07 -2.57e-06 -4.28e-06 -5.99e-06 ...</code></pre>
<p>The solution comes with a time indicator called <code>time</code>, with <code>m1, s1, m2, s2</code> representing the states’ phase, as well as the phase of the error terms <code>em1s1</code> and <code>es2s1</code> related to <code>s1</code>.
By differentiating, we get the instantaneous frequencies: <code>dm1, ds1, dm2, ds2, dm1s1</code> and <code>ds2s1</code>, where the prefix <span class="math inline">\(d\)</span> refers to the differential.</p>
<p>It is instructive to vary the coupling strengths in a systematic way, to see what happens.
Let’s do that, but we first focus on <code>em1s1</code> and <code>es2s1</code>, the error terms that contribute to phase change in <code>s1.</code> In the code that follows, we define <code>ks1m1</code> to be <code>1, .8, .6, .4</code>, and <code>.2</code>, and <code>ks2m2</code> is <code>1</code> and then <code>.75</code>.
We run all combinations of <code>ks1m1</code> and <code>ks2m2.</code></p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:chapTappersSol1"></span>
<img src="08_chapTappers_files/figure-html/chapTappersSol1-1.png" alt="Error terms in s1 due to competing influences of m1 and s2. The error terms are shown as thin lines. The columns show five different values of ks1m1 (1, .8, .6, .4, .2), the rows show two different values of ks2m2 (1, .75). The thick line is the average of the thin lines. Overall, these figures show the instantaneous frequency (without the eigen-frequency) of the error terms contribution to s1" width="100%"><p class="caption">
Figure 7.4: Error terms in s1 due to competing influences of m1 and s2. The error terms are shown as thin lines. The columns show five different values of ks1m1 (1, .8, .6, .4, .2), the rows show two different values of ks2m2 (1, .75). The thick line is the average of the thin lines. Overall, these figures show the instantaneous frequency (without the eigen-frequency) of the error terms contribution to s1
</p>
</div>
<p>The panels in the top row of Figure <a href="chapTappers1.html#fig:chapTappersSol1">7.4</a> show the error terms that contribute to the state of <code>s1</code>, for <code>ks1m1 = 1, .8, .6, .4, .2</code>, and given <code>ks2m2 = 1</code>. The bottom row shows the error terms when <code>ks2m2 = .75</code>.
The global error term is shown as the thick line, being the sum of the two error terms (<code>$\epsilon_{m1-s1}$ and $\epsilon_{s2-s1}$</code>) divided by 2.
In fact, the vertical scale is not that important here.</p>
<p>The dotted vertical line marks the anti-phase time of the metronomes.
One can see that the crossing point of the error term curves is delayed.
When <code>ks1m1 = .4</code> the curve has flipped.
It marks the fact that the tapping is more in line with <span class="math inline">\(s2\)</span> than with the own <span class="math inline">\(s1\)</span>.</p>
<p>In a similar way, it is possible to calculate the error terms for <span class="math inline">\(s2\)</span> based on the pulling forces of the metronome and the partner subject.</p>
<p>Next we show the phase, just to illustrate that there is not much to see because phase is increasing continuously and phase fluctuation is minimal with respect to this increase.
We show the code to show the details of how phase is treated.</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cbPalette</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#56B4E9"</span>,<span class="st">"#E69F00"</span>, <span class="st">"#56B4E9"</span>,<span class="st">"#E69F00"</span>,<span class="st">"#D55E00"</span><span class="op">)</span></span>
<span><span class="va">Solution</span> <span class="op">%&gt;%</span> <span class="fu">pivot_longer</span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">m1</span>,<span class="va">s1</span>,<span class="va">m2</span>,<span class="va">s2</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">group_by</span><span class="op">(</span><span class="va">time</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span> <span class="va">time</span>,y <span class="op">=</span> <span class="va">value</span>, color <span class="op">=</span> <span class="va">name</span><span class="op">)</span>,size<span class="op">=</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">36.6</span><span class="op">/</span><span class="fl">2</span>, color <span class="op">=</span> <span class="st">"#D55E00"</span>, linetype <span class="op">=</span> <span class="st">"dotted"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span>values<span class="op">=</span><span class="va">cbPalette</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_colour_manual</span><span class="op">(</span>labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"m1"</span>,<span class="st">"s1"</span>,<span class="st">"m2"</span>,<span class="st">"s2"</span><span class="op">)</span>,values<span class="op">=</span><span class="va">cbPalette</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_grid</span><span class="op">(</span><span class="va">ks2m2</span><span class="op">~</span><span class="va">ks1m1</span><span class="op">)</span></span>
<span><span class="co"># \@ref(fig:chapTappersSol2)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:chapTappersPhase2"></span>
<img src="08_chapTappers_files/figure-html/chapTappersPhase2-1.png" alt="Phase of all units" width="100%"><p class="caption">
Figure 7.5: Phase of all units
</p>
</div>
<p>An alternative representation is the <em>instantaneous period</em>, with period on the vertical axis.
It’s the inverse of the instantaneous frequency, which we obtain by differentiating the phase. Accordingly, with <span class="math inline">\(ks1m1 = ks2m2 = 1\)</span>, subjects follow their metronomes and therefore the instantaneous period of their tapping is on 600 ms and 610 ms. Note that the blue curves (from <span class="math inline">\(s1\)</span>) are the reversed curves from those in figure <a href="chapTappers1.html#fig:chapTappersSol1">7.4</a>.</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">do_period</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">value</span>,<span class="va">dt</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">return</span> <span class="op">=</span> <span class="fl">2000</span><span class="op">*</span><span class="va">pi</span><span class="op">*</span><span class="va">dt</span><span class="op">/</span><span class="va">value</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">cbPalette</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"lightblue"</span>,<span class="st">"#f1c9a5"</span>, <span class="st">"#56B4E9"</span>,<span class="st">"#E69F00"</span>,<span class="st">"#D55E00"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Solution</span> <span class="op">%&gt;%</span> <span class="fu">pivot_longer</span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">dm1</span>,<span class="va">ds1</span>,<span class="va">dm2</span>,<span class="va">ds2</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">mutate</span><span class="op">(</span>value <span class="op">=</span> <span class="fu">do_period</span><span class="op">(</span><span class="va">value</span>,<span class="va">dt</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">group_by</span><span class="op">(</span><span class="va">time</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span> <span class="va">time</span>,y <span class="op">=</span> <span class="va">value</span>, color<span class="op">=</span><span class="va">name</span><span class="op">)</span>, size<span class="op">=</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">36.6</span><span class="op">/</span><span class="fl">2</span>, color <span class="op">=</span> <span class="st">"#D55E00"</span>, linetype <span class="op">=</span> <span class="st">"dotted"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ylim</span><span class="op">(</span><span class="fl">585</span>,<span class="fl">635</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span>values<span class="op">=</span><span class="va">cbPalette</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_colour_manual</span><span class="op">(</span>labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"dm1"</span>,<span class="st">"dm2"</span>,<span class="st">"ds1"</span>,<span class="st">"ds2"</span><span class="op">)</span>,values<span class="op">=</span><span class="va">cbPalette</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_grid</span><span class="op">(</span><span class="va">ks2m2</span><span class="op">~</span><span class="va">ks1m1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># \@ref(fig:chapTappersSol2)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:chapTappersSol2"></span>
<img src="08_chapTappers_files/figure-html/chapTappersSol2-1.png" alt="Instantaneous periods. The columns show five different values of ks1m1, the rows show two different values of ks2m2" width="100%"><p class="caption">
Figure 7.6: Instantaneous periods. The columns show five different values of ks1m1, the rows show two different values of ks2m2
</p>
</div>
<p>The figure reveals that the blue curves (representing the instantaneous period of <span class="math inline">\(s1\)</span>) become slightly more pronounced and shifted when there is a mutual influence due to <span class="math inline">\(ks2m2 = .75\)</span>.</p>
<p>Next, we show the relative phase, rather than the instantaneous period.
As the phase is continuously increasing it is more practical to look at the phase relative to the metronome, and rotate the axis such that the interval covers <span class="math inline">\([-\pi,+\pi]\)</span>.</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">do_rotate</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">return</span> <span class="op">=</span>  <span class="op">(</span><span class="op">(</span><span class="va">value</span> <span class="op">+</span> <span class="va">pi</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html">%%</a></span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">)</span><span class="op">)</span><span class="op">-</span><span class="va">pi</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">cbPalette</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#56B4E9"</span>,<span class="st">"#E69F00"</span>,<span class="st">"#D55E00"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Solution</span> <span class="op">%&gt;%</span> <span class="fu">mutate</span><span class="op">(</span>m1s1 <span class="op">=</span> <span class="fu">do_rotate</span><span class="op">(</span><span class="va">m1</span> <span class="op">-</span> <span class="va">s1</span><span class="op">)</span>, m2s2 <span class="op">=</span> <span class="fu">do_rotate</span><span class="op">(</span><span class="va">m2</span> <span class="op">-</span> <span class="va">s2</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">pivot_longer</span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">m1s1</span>,<span class="va">m2s2</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">group_by</span><span class="op">(</span><span class="va">time</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span> <span class="va">time</span>,y <span class="op">=</span> <span class="va">value</span>, color<span class="op">=</span><span class="va">name</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="co"># ylim(5.75,6.35) +</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span>values<span class="op">=</span><span class="va">cbPalette</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_colour_manual</span><span class="op">(</span>labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"m1 - s1"</span>,<span class="st">"m2 - s2"</span><span class="op">)</span>,values<span class="op">=</span><span class="va">cbPalette</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_grid</span><span class="op">(</span><span class="va">ks2m2</span><span class="op">~</span><span class="va">ks1m1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>y<span class="op">=</span><span class="st">"relative phase"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># \@ref(fig:chapTappersSol3)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:chapTappersSol3"></span>
<img src="08_chapTappers_files/figure-html/chapTappersSol3-1.png" alt="Relative phase of s1 and s2. The columns show five different values of ks1m1, the rows show two different values of ks2m2" width="100%"><p class="caption">
Figure 7.7: Relative phase of s1 and s2. The columns show five different values of ks1m1, the rows show two different values of ks2m2
</p>
</div>
<p>This viewpoint is of interest when phase delays enter the picture.
The next figure shows the relative phase with phase delays, when <span class="math inline">\(ds1m1 = ds2m2 = 1\)</span>.</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Set the time points</span></span>
<span><span class="va">Solution</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">dt</span> <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">100</span></span>
<span><span class="va">time_points</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">36.6</span>, by <span class="op">=</span> <span class="va">dt</span><span class="op">)</span></span>
<span><span class="va">state</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>m1 <span class="op">=</span> <span class="fl">0</span>, s1 <span class="op">=</span> <span class="fl">0</span>, m2 <span class="op">=</span> <span class="fl">0</span>, s2 <span class="op">=</span> <span class="fl">0</span>, em1s1 <span class="op">=</span> <span class="fl">0</span>, es2s1 <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">ks1m1</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">.2</span>,<span class="op">-</span><span class="fl">.2</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">ks2m2</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">.75</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">parm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>ks1m1 <span class="op">=</span> <span class="va">ks1m1</span>,ks2m2 <span class="op">=</span> <span class="va">ks2m2</span>, ds1m1 <span class="op">=</span> <span class="fl">1</span>, ds2m2 <span class="op">=</span> <span class="fl">1</span>, ds1s2 <span class="op">=</span> <span class="fl">0</span>, ds2s1 <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span>    <span class="va">solution</span> <span class="op">&lt;-</span> <span class="fu">ode</span><span class="op">(</span> <span class="va">state</span>, <span class="va">time_points</span>, <span class="va">dydt</span>, parms <span class="op">=</span> <span class="va">parm</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>      <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">time</span>,<span class="va">m1</span>,<span class="va">s1</span>,<span class="va">m2</span>,<span class="va">s2</span>,<span class="va">em1s1</span>,<span class="va">es2s1</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>      <span class="fu">mutate</span><span class="op">(</span>ks1m1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">ks1m1</span><span class="op">)</span>, ks2m2<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">ks2m2</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">Solution</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">Solution</span>, <span class="va">solution</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">Solution</span> <span class="op">&lt;-</span> <span class="va">Solution</span> <span class="op">%&gt;%</span> <span class="fu">mutate</span><span class="op">(</span></span>
<span>  dm1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">NA</span>,<span class="fu"><a href="https://rdrr.io/r/base/diff.html">diff</a></span><span class="op">(</span><span class="va">m1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  ds1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">NA</span>,<span class="fu"><a href="https://rdrr.io/r/base/diff.html">diff</a></span><span class="op">(</span><span class="va">s1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  dm2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">NA</span>,<span class="fu"><a href="https://rdrr.io/r/base/diff.html">diff</a></span><span class="op">(</span><span class="va">m2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  ds2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">NA</span>,<span class="fu"><a href="https://rdrr.io/r/base/diff.html">diff</a></span><span class="op">(</span><span class="va">s2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  dem1s1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">NA</span>,<span class="fu"><a href="https://rdrr.io/r/base/diff.html">diff</a></span><span class="op">(</span><span class="va">em1s1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  des2s1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="cn">NA</span>,<span class="fu"><a href="https://rdrr.io/r/base/diff.html">diff</a></span><span class="op">(</span><span class="va">es2s1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">do_rotate</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">return</span> <span class="op">=</span>  <span class="op">(</span><span class="va">value</span> <span class="op">+</span> <span class="va">pi</span><span class="op">)</span><span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html">%%</a></span><span class="op">(</span><span class="fl">2</span><span class="op">*</span><span class="va">pi</span><span class="op">)</span><span class="op">-</span><span class="va">pi</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">cbPalette</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#56B4E9"</span>,<span class="st">"#E69F00"</span>,<span class="st">"#D55E00"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">Solution</span> <span class="op">%&gt;%</span> <span class="fu">mutate</span><span class="op">(</span>m1s1 <span class="op">=</span> <span class="fu">do_rotate</span><span class="op">(</span><span class="va">m1</span> <span class="op">-</span> <span class="va">s1</span><span class="op">)</span>, m2s2 <span class="op">=</span> <span class="fu">do_rotate</span><span class="op">(</span><span class="va">m2</span> <span class="op">-</span> <span class="va">s2</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> </span>
<span>  <span class="fu">pivot_longer</span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">m1s1</span>,<span class="va">m2s2</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">group_by</span><span class="op">(</span><span class="va">time</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span> <span class="va">time</span>,y <span class="op">=</span> <span class="va">value</span>, color<span class="op">=</span><span class="va">name</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="co"># ylim(5.75,6.35) +</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span>values<span class="op">=</span><span class="va">cbPalette</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_colour_manual</span><span class="op">(</span>labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"m1 - s1"</span>,<span class="st">"m2 - s2"</span><span class="op">)</span>,values<span class="op">=</span><span class="va">cbPalette</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_grid</span><span class="op">(</span><span class="va">ks2m2</span><span class="op">~</span><span class="va">ks1m1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span>y<span class="op">=</span><span class="st">"relative phase"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># \@ref(fig:chapTappersSol4)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:chapTappersSol4"></span>
<img src="08_chapTappers_files/figure-html/chapTappersSol4-1.png" alt="Relative phase of s1 and s2, with phase delay ds1m1 = ds2m2 = 1. The columns show five different values of ks1m1, the rows show two different values of ks2m2" width="100%"><p class="caption">
Figure 7.8: Relative phase of s1 and s2, with phase delay ds1m1 = ds2m2 = 1. The columns show five different values of ks1m1, the rows show two different values of ks2m2
</p>
</div>
<p>Note that the phase delay tends to shift the curve downward, implying anticipation, while similar figures appear, except at the beginning of the curves because at that point, we start our state at the zero position.</p>
<p>The examples reveal the complex character of the dynamical system.
Despite the fact that it is composed of simple sinusoids, its final behavior can be rather surprising.</p>
</div>
<div id="general-specification" class="section level3 unnumbered">
<h3>General specification<a class="anchor" aria-label="anchor" href="#general-specification"><i class="fas fa-link"></i></a>
</h3>
<p>While it is possible to generalize the dynamic system to more units arranged in different configurations, we will not explore that topic here. We will focus on the current particular setup because it has been used in an experiment, and the data from that experiment will be analyzed using the dynamic model validated in this chapter.</p>
<p>Therefore, rather than expanding the dynamic system, we aim to validate whether this dynamic system is worth the effort. However, before proceeding, it may be of interest to generalize the above approach using equation <a href="chapTappers1.html#eq:chapTappersequation1">(7.2)</a>:</p>
<p><span class="math display" id="eq:chapTappersequation1">\[\begin{equation}
\frac{d\theta_{i}}{dt} = \omega_{i} + \sum_j K_{i,j} sin(\theta_{t,j} - \theta_{t,i} + D_{i,j}),~
with ~ \theta_i(0) = 0 \tag{7.2}
\end{equation}\]</span></p>
<p>where <span class="math inline">\(\theta\)</span> is the phase,
<span class="math inline">\(i,j\)</span> is an index for elements in <span class="math inline">\(\left\{ m1,s1,s2,m2 \right\}\)</span>, and
<span class="math inline">\(\omega\)</span> is the instantaneous frequency, set as <span class="math inline">\(\omega_i = \frac{2\pi*}{.6}~[\frac{rad}{sec}]\)</span>, for <span class="math inline">\(i=1,2\)</span> and <span class="math inline">\(\omega_i = \frac{2\pi}{.61}~[\frac{rad}{sec}]\)</span> for <span class="math inline">\(i=3,4\)</span>.</p>
<p>The matrix <span class="math inline">\(K\)</span> contains the coupling parameters from rows (index <span class="math inline">\(i\)</span>) to columns (index <span class="math inline">\(j\)</span>), and the parameters are in the range <span class="math inline">\([0,1]\)</span>.
Accordingly, <span class="math inline">\(K(2,1) = K_{s1,m1} = ks1m1\)</span>.
The matrix <span class="math inline">\(D\)</span> contains the delay parameters in the range <span class="math inline">\([-\pi,\pi]\)</span>.</p>
<p>Matrices K and D are design matrices that define the dynamic system. Dots mean that no parameter is created. If a parameter is created (e.g. <span class="math inline">\(ks1m1\)</span>), then there are two possibilities: either that parameter gets a defined value and data can be generated with it, or the value of that parameter is estimated from given data. In this chapter, we’ll first define them, and then estimate them. We can then check whether the estimation is correctly done.</p>
<p><span class="math display">\[
K = \begin{matrix}   
&amp;m1~~~~~~~~~~s1~~~~~~~~~~m2~~~~~~~~~~s2\\
\begin{matrix}   
&amp;m1 \\
&amp;s1 \\
&amp;m2 \\
&amp;s2 \\
\end{matrix} &amp;
\begin{bmatrix}
. &amp;. &amp;. &amp;. \\
ks1m1 &amp;. &amp;. &amp;1-ks1m1 \\
. &amp;. &amp;. &amp;. \\
. &amp;1-ks2m2  &amp;ks2m2 &amp;.\\
\end{bmatrix}
\end{matrix}
\]</span></p>
<p><span class="math display">\[
D = \begin{matrix}   
&amp;m1~~~~~s1~~~~~m2~~~~~s2\\
\begin{matrix}   
&amp;m1 \\
&amp;s1 \\
&amp;m2 \\
&amp;s2 \\
\end{matrix} &amp;
\begin{bmatrix}
. &amp;. &amp;. &amp;. \\
ds1m1 &amp;. &amp;. &amp;. \\
. &amp;. &amp;. &amp;. \\
. &amp;.  &amp;ds2m2 &amp;.\\
\end{bmatrix}
\end{matrix}
\]</span></p>
</div>
<div id="running-a-simulation-app" class="section level3 unnumbered">
<h3>Running a simulation app<a class="anchor" aria-label="anchor" href="#running-a-simulation-app"><i class="fas fa-link"></i></a>
</h3>
<p>Equation <a href="chapTappers1.html#eq:chapTappersequation1">(7.2)</a> is non-linear and therefore it is useful to explore it with simulations. We refer to a shiny application <a href="http://odetappers.shinyapps.io/odetappers2/">here</a><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;See &lt;a href="http://odetappers.shinyapps.io/odetappers2/" class="uri"&gt;http://odetappers.shinyapps.io/odetappers2/&lt;/a&gt;&lt;/p&gt;'><sup>29</sup></a>, which readers may explore.
Given the above explanation, we believe that the tool is self-explanatory.</p>
<!-- <iframe src="http://odetappers.shinyapps.io/odetappers2/" width="750" height="1000"></iframe> -->
</div>
<div id="generating-fake-observations" class="section level3 unnumbered">
<h3>Generating fake observations<a class="anchor" aria-label="anchor" href="#generating-fake-observations"><i class="fas fa-link"></i></a>
</h3>
<p>Now that we have system equations that can generate the states of our dynamic system, our next goal is to generate observations. Currently, these are fake observations of tics and taps of metronomes and subjects. We proceed in two steps:</p>
<ul>
<li><p>First, we use the generated states and extract the time at which the phase becomes a multiple of <span class="math inline">\(2\pi\)</span>. Those time instances correspond to tics or taps from metronomes and subjects.</p></li>
<li><p>Then, we add noise to the tap times, using a normal distribution that simulates human variability in finger tapping tasks.</p></li>
</ul>
<p>The dataset thus generated will be used to retrieve the parameters of the state-space model.
But let’s first try to generate these observations.</p>
</div>
<div id="constraints-in-parameters" class="section level3 unnumbered">
<h3>Constraints in parameters<a class="anchor" aria-label="anchor" href="#constraints-in-parameters"><i class="fas fa-link"></i></a>
</h3>
<p>Based on the <em>drifting metronomes</em> paradigm, in which subjects are asked to tap along with the metronome heard through their headphones, we assume that most subjects will indeed be able to adhere to their own metronome. This implies that the coupling strength <span class="math inline">\(ks1m1\)</span> and <span class="math inline">\(ks2m2\)</span> will be rarely &lt; .4 because in that case they actually follow the partner (as illustrated in the above figures). Furthermore, we assume for testing purposes that both subjects have the same distribution of coupling strength. Accordingly, we first generate coupling strength values for subject 1. Then we reshuffle these values and assign coupling strength values to subject 2.</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># distribution of coupling strengths</span></span>
<span><span class="va">K1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>ks1m1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Beta.html">rbeta</a></span><span class="op">(</span><span class="fl">20</span>,<span class="fl">4</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="va">K1</span> <span class="op">&lt;-</span> <span class="va">K1</span> <span class="op">%&gt;%</span> <span class="fu">mutate</span><span class="op">(</span>ks2m2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="va">ks1m1</span><span class="op">)</span> <span class="op">)</span></span>
<span></span>
<span><span class="co"># distribution of delay times</span></span>
<span><span class="va">D2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>ds1m1 <span class="op">=</span> <span class="fu">rsn</span><span class="op">(</span>n<span class="op">=</span><span class="fl">20</span>, xi<span class="op">=</span><span class="fl">0</span>, omega<span class="op">=</span><span class="fl">.6</span>, alpha<span class="op">=</span><span class="fl">3</span>, tau<span class="op">=</span><span class="fl">0</span>, dp<span class="op">=</span><span class="cn">NULL</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="va">D2</span> <span class="op">&lt;-</span> <span class="va">D2</span> <span class="op">%&gt;%</span> <span class="fu">mutate</span><span class="op">(</span>ds2m2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="va">ds1m1</span><span class="op">)</span>, ds1s2 <span class="op">=</span> <span class="fl">0</span>, ds2s1 <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># delays set to zero because we want to test the system without delays and with delays</span></span>
<span><span class="va">D1</span> <span class="op">&lt;-</span> <span class="va">D2</span> <span class="op">%&gt;%</span>  <span class="fu">mutate</span><span class="op">(</span> ds1m1 <span class="op">=</span> <span class="fl">0</span>, ds2m2 <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># row bind the same coupling parameters</span></span>
<span><span class="va">K</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">K1</span>,<span class="va">K1</span><span class="op">)</span></span>
<span><span class="co"># row bind different delay parameters</span></span>
<span><span class="va">D</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">D1</span>,<span class="va">D2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># check distributions visually</span></span>
<span><span class="va">cbPalette</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"#999999"</span>, <span class="st">"#E69F00"</span>, <span class="st">"#56B4E9"</span>, <span class="st">"#009E73"</span>, <span class="st">"#F0E442"</span>, <span class="st">"#0072B2"</span>, <span class="st">"#D55E00"</span>, <span class="st">"#CC79A7"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">K_long</span> <span class="op">&lt;-</span> <span class="va">K</span> <span class="op">%&gt;%</span> <span class="fu">pivot_longer</span><span class="op">(</span>cols <span class="op">=</span> <span class="fu">everything</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pk</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">K_long</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">name</span>,y<span class="op">=</span><span class="va">value</span>, color <span class="op">=</span> <span class="va">name</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1</span>, shape <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span>values<span class="op">=</span><span class="va">cbPalette</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_colour_manual</span><span class="op">(</span>values<span class="op">=</span><span class="va">cbPalette</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ylim</span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">D_long</span> <span class="op">&lt;-</span> <span class="va">D</span> <span class="op">%&gt;%</span> <span class="fu">pivot_longer</span><span class="op">(</span>cols <span class="op">=</span> <span class="fu">everything</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pd</span> <span class="op">&lt;-</span> <span class="fu">ggplot</span><span class="op">(</span><span class="va">D_long</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">name</span>,y<span class="op">=</span><span class="va">value</span>, color <span class="op">=</span> <span class="va">name</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">1</span>, shape <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_fill_manual</span><span class="op">(</span>values<span class="op">=</span><span class="va">cbPalette</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_colour_manual</span><span class="op">(</span>values<span class="op">=</span><span class="va">cbPalette</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">ylim</span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">pk</span> <span class="op">+</span> <span class="va">pd</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:chapTappersKDdistributions"></span>
<img src="08_chapTappers_files/figure-html/chapTappersKDdistributions-1.png" alt="Distributions of coupling strength and phase delay parameters for simulations" width="100%"><p class="caption">
Figure 7.9: Distributions of coupling strength and phase delay parameters for simulations
</p>
</div>
<div class="inline-table"><table class="table table-striped" style="font-size: 10px; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">
<span id="tab:chapTappersKDtable">Table 7.1: </span>K and D parameters for 40 simulations
</caption>
<thead><tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
ks1m1
</th>
<th style="text-align:right;">
ks2m2
</th>
<th style="text-align:right;">
ds1m1
</th>
<th style="text-align:right;">
ds2m2
</th>
<th style="text-align:right;">
ds1s2
</th>
<th style="text-align:right;">
ds2s1
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
0.7292610
</td>
<td style="text-align:right;">
0.8884887
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
2
</td>
<td style="text-align:right;">
0.4199088
</td>
<td style="text-align:right;">
0.3992122
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
3
</td>
<td style="text-align:right;">
0.9130523
</td>
<td style="text-align:right;">
0.7144593
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
4
</td>
<td style="text-align:right;">
0.6100897
</td>
<td style="text-align:right;">
0.7292610
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
5
</td>
<td style="text-align:right;">
0.6570294
</td>
<td style="text-align:right;">
0.6087971
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
6
</td>
<td style="text-align:right;">
0.8726596
</td>
<td style="text-align:right;">
0.9033425
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
7
</td>
<td style="text-align:right;">
0.7144593
</td>
<td style="text-align:right;">
0.6570294
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
8
</td>
<td style="text-align:right;">
0.4353818
</td>
<td style="text-align:right;">
0.6100897
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
9
</td>
<td style="text-align:right;">
0.8884887
</td>
<td style="text-align:right;">
0.9373000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
10
</td>
<td style="text-align:right;">
0.9033425
</td>
<td style="text-align:right;">
0.6016186
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
11
</td>
<td style="text-align:right;">
0.4733592
</td>
<td style="text-align:right;">
0.4199088
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
12
</td>
<td style="text-align:right;">
0.3093954
</td>
<td style="text-align:right;">
0.9130523
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
13
</td>
<td style="text-align:right;">
0.3992122
</td>
<td style="text-align:right;">
0.4353818
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
14
</td>
<td style="text-align:right;">
0.6016186
</td>
<td style="text-align:right;">
0.4733592
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
15
</td>
<td style="text-align:right;">
0.6087971
</td>
<td style="text-align:right;">
0.8726596
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
16
</td>
<td style="text-align:right;">
0.9373000
</td>
<td style="text-align:right;">
0.6048375
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
17
</td>
<td style="text-align:right;">
0.8880231
</td>
<td style="text-align:right;">
0.3093954
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
18
</td>
<td style="text-align:right;">
0.6542134
</td>
<td style="text-align:right;">
0.5550383
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
19
</td>
<td style="text-align:right;">
0.5550383
</td>
<td style="text-align:right;">
0.8880231
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
20
</td>
<td style="text-align:right;">
0.6048375
</td>
<td style="text-align:right;">
0.6542134
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0.0000000
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
21
</td>
<td style="text-align:right;">
0.7292610
</td>
<td style="text-align:right;">
0.8884887
</td>
<td style="text-align:right;">
0.2440232
</td>
<td style="text-align:right;">
-0.0442601
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
22
</td>
<td style="text-align:right;">
0.4199088
</td>
<td style="text-align:right;">
0.3992122
</td>
<td style="text-align:right;">
0.7288762
</td>
<td style="text-align:right;">
0.0582029
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
23
</td>
<td style="text-align:right;">
0.9130523
</td>
<td style="text-align:right;">
0.7144593
</td>
<td style="text-align:right;">
0.5775512
</td>
<td style="text-align:right;">
0.2364962
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
24
</td>
<td style="text-align:right;">
0.6100897
</td>
<td style="text-align:right;">
0.7292610
</td>
<td style="text-align:right;">
-0.0134876
</td>
<td style="text-align:right;">
0.3699094
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
25
</td>
<td style="text-align:right;">
0.6570294
</td>
<td style="text-align:right;">
0.6087971
</td>
<td style="text-align:right;">
0.4263449
</td>
<td style="text-align:right;">
0.5258656
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
26
</td>
<td style="text-align:right;">
0.8726596
</td>
<td style="text-align:right;">
0.9033425
</td>
<td style="text-align:right;">
0.2157303
</td>
<td style="text-align:right;">
0.4142806
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
27
</td>
<td style="text-align:right;">
0.7144593
</td>
<td style="text-align:right;">
0.6570294
</td>
<td style="text-align:right;">
0.2364962
</td>
<td style="text-align:right;">
0.4873070
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
28
</td>
<td style="text-align:right;">
0.4353818
</td>
<td style="text-align:right;">
0.6100897
</td>
<td style="text-align:right;">
0.2208240
</td>
<td style="text-align:right;">
0.2208240
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
29
</td>
<td style="text-align:right;">
0.8884887
</td>
<td style="text-align:right;">
0.9373000
</td>
<td style="text-align:right;">
0.2622691
</td>
<td style="text-align:right;">
0.2157303
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
30
</td>
<td style="text-align:right;">
0.9033425
</td>
<td style="text-align:right;">
0.6016186
</td>
<td style="text-align:right;">
0.1694013
</td>
<td style="text-align:right;">
-0.0134876
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
31
</td>
<td style="text-align:right;">
0.4733592
</td>
<td style="text-align:right;">
0.4199088
</td>
<td style="text-align:right;">
0.3154341
</td>
<td style="text-align:right;">
0.3154341
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
32
</td>
<td style="text-align:right;">
0.3093954
</td>
<td style="text-align:right;">
0.9130523
</td>
<td style="text-align:right;">
0.5258656
</td>
<td style="text-align:right;">
0.4263449
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
33
</td>
<td style="text-align:right;">
0.3992122
</td>
<td style="text-align:right;">
0.4353818
</td>
<td style="text-align:right;">
0.7747212
</td>
<td style="text-align:right;">
0.0201852
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
34
</td>
<td style="text-align:right;">
0.6016186
</td>
<td style="text-align:right;">
0.4733592
</td>
<td style="text-align:right;">
0.3699094
</td>
<td style="text-align:right;">
0.2622691
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
35
</td>
<td style="text-align:right;">
0.6087971
</td>
<td style="text-align:right;">
0.8726596
</td>
<td style="text-align:right;">
-0.0442601
</td>
<td style="text-align:right;">
0.2676280
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
36
</td>
<td style="text-align:right;">
0.9373000
</td>
<td style="text-align:right;">
0.6048375
</td>
<td style="text-align:right;">
0.4142806
</td>
<td style="text-align:right;">
0.2440232
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
37
</td>
<td style="text-align:right;">
0.8880231
</td>
<td style="text-align:right;">
0.3093954
</td>
<td style="text-align:right;">
0.0201852
</td>
<td style="text-align:right;">
0.5775512
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
38
</td>
<td style="text-align:right;">
0.6542134
</td>
<td style="text-align:right;">
0.5550383
</td>
<td style="text-align:right;">
0.2676280
</td>
<td style="text-align:right;">
0.7288762
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
39
</td>
<td style="text-align:right;">
0.5550383
</td>
<td style="text-align:right;">
0.8880231
</td>
<td style="text-align:right;">
0.0582029
</td>
<td style="text-align:right;">
0.1694013
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
40
</td>
<td style="text-align:right;">
0.6048375
</td>
<td style="text-align:right;">
0.6542134
</td>
<td style="text-align:right;">
0.4873070
</td>
<td style="text-align:right;">
0.7747212
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
</tr>
</tbody>
</table></div>
<p>Constraints in phase delays can be justified by studies showing that humans tend to anticipate to the beat<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content="&lt;p&gt;See Repp and Su (2012) for a review of finger tapping and anticipation.&lt;/p&gt;"><sup>30</sup></a>.</p>
<p>Table <a href="chapTappers1.html#tab:chapTappersKDtable">7.1</a> shows the parameters for 40 state equations, that is, 40 dynamical systems.
The columns represent the number and the parameters <span class="math inline">\(ks1m1, ks2m2, ds1m1, ds2m2\)</span>. We don’t specify <span class="math inline">\(ds2s1\)</span> nor <span class="math inline">\(ds1s2\)</span>.
Note that the first and second 20 dynamic systems have the same coupling strengths. The first 20 systems have zero phase delay, while the second 20 systems have a non-zero phase delay:</p>
<p>Given these parameters, we generate the states of each system.</p>
</div>
<div id="generate-states" class="section level3 unnumbered">
<h3>Generate states<a class="anchor" aria-label="anchor" href="#generate-states"><i class="fas fa-link"></i></a>
</h3>
<p>The states are then generated (see Code script <code>Code/chapTappers/chapTappers_02_DataPreparation.R</code>) using the parameters shown in table <a href="chapTappers1.html#tab:chapTappersKDtable">7.1</a>.</p>
<div class="inline-table"><table class="table table-striped" style="font-size: 10px; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">
<span id="tab:chapTappers6odePhi12view">Table 7.2: </span>States of model 1
</caption>
<thead><tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
time
</th>
<th style="text-align:right;">
m1
</th>
<th style="text-align:right;">
s1
</th>
<th style="text-align:right;">
m2
</th>
<th style="text-align:right;">
s2
</th>
<th style="text-align:left;">
model
</th>
<th style="text-align:left;">
param
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
599
</td>
<td style="text-align:right;">
0.598
</td>
<td style="text-align:right;">
6.262241
</td>
<td style="text-align:right;">
6.258092
</td>
<td style="text-align:right;">
6.159582
</td>
<td style="text-align:right;">
6.160385
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
0.7, 0.94
0, 0, 0, 0
</td>
</tr>
<tr>
<td style="text-align:left;">
600
</td>
<td style="text-align:right;">
0.599
</td>
<td style="text-align:right;">
6.272713
</td>
<td style="text-align:right;">
6.268551
</td>
<td style="text-align:right;">
6.169882
</td>
<td style="text-align:right;">
6.170688
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
0.7, 0.94
0, 0, 0, 0
</td>
</tr>
<tr>
<td style="text-align:left;">
601
</td>
<td style="text-align:right;">
0.600
</td>
<td style="text-align:right;">
6.283185
</td>
<td style="text-align:right;">
6.279010
</td>
<td style="text-align:right;">
6.180182
</td>
<td style="text-align:right;">
6.180991
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
0.7, 0.94
0, 0, 0, 0
</td>
</tr>
<tr>
<td style="text-align:left;">
602
</td>
<td style="text-align:right;">
0.601
</td>
<td style="text-align:right;">
6.293657
</td>
<td style="text-align:right;">
6.289469
</td>
<td style="text-align:right;">
6.190483
</td>
<td style="text-align:right;">
6.191294
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
0.7, 0.94
0, 0, 0, 0
</td>
</tr>
<tr>
<td style="text-align:left;">
603
</td>
<td style="text-align:right;">
0.602
</td>
<td style="text-align:right;">
6.304129
</td>
<td style="text-align:right;">
6.299927
</td>
<td style="text-align:right;">
6.200783
</td>
<td style="text-align:right;">
6.201596
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
0.7, 0.94
0, 0, 0, 0
</td>
</tr>
<tr>
<td style="text-align:left;">
604
</td>
<td style="text-align:right;">
0.603
</td>
<td style="text-align:right;">
6.314601
</td>
<td style="text-align:right;">
6.310386
</td>
<td style="text-align:right;">
6.211083
</td>
<td style="text-align:right;">
6.211899
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
0.7, 0.94
0, 0, 0, 0
</td>
</tr>
</tbody>
</table></div>
<p>All generated states are contained in the data frame <code>States</code>. Table <a href="chapTappers1.html#tab:chapTappers6odePhi12view">7.2</a> shows six rows (from row 599 to row 604) from this data frame. The columns show the time of each sample (<code>time</code>), and then the phase of each unit (<code>m1</code>, <code>s1</code>, <code>m2</code>, <code>s2</code>), the number of the simulated system (<code>sim</code>), and the associated parameters K (first 2 numbers) and D (last 4 numbers) (<code>param</code>).</p>
</div>
<div id="generate-observations" class="section level3 unnumbered">
<h3>Generate observations<a class="anchor" aria-label="anchor" href="#generate-observations"><i class="fas fa-link"></i></a>
</h3>
<p>Using the states calculated in the previous step, time values (for tics and taps) are taken when the phase is closest to multiples of <span class="math inline">\(2\pi\)</span>.
For example, at time 0.6, metronome 1 (see column <code>names</code>) has produced a tick, and its phase is <span class="math inline">\(6.283185\)</span>, or <span class="math inline">\(2pi\)</span>, as shown in column <code>m1</code>.
At time 0.6006, subject 1 has produced a tap, as shown in <code>s1</code>. The phase is close to <span class="math inline">\(2\pi\)</span>, but has a small acceptable peak extraction error.
And so on.</p>
<p>The time values can be found using peak finding on modulo 2*pi on the phase values, per unit.</p>
<p>Finally, having extracted the taps and tics, some noise is added to the time values.
The noise has the characteristic <span class="math inline">\(N(0, \sigma)\)</span>, with <span class="math inline">\(\sigma\)</span> defined as <span class="math inline">\(0.005\)</span> [s].
Note that we apply it only to the taps (subjects), not to ticks (metronomes).
Finally, since the phase values are still defined in the interval <span class="math inline">\([Ø,2\pi]\)</span>,
we rotate the phase to the interval <span class="math inline">\([-pi,+pi]\)</span>, such that 0 is right in the middle of that scale.
The result (see Code script <code>Code/chapTappers/chapTappers_02_DataPreparation.R</code>) is:</p>
<div class="inline-table"><table class="table table-striped" style="font-size: 10px; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">
<span id="tab:chapTappersObservationNoise">Table 7.3: </span>Observations
</caption>
<thead><tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
time
</th>
<th style="text-align:right;">
m1
</th>
<th style="text-align:right;">
s1
</th>
<th style="text-align:right;">
m2
</th>
<th style="text-align:right;">
s2
</th>
<th style="text-align:left;">
model
</th>
<th style="text-align:left;">
param
</th>
<th style="text-align:right;">
phase
</th>
<th style="text-align:right;">
names_indicator
</th>
<th style="text-align:left;">
names
</th>
<th style="text-align:right;">
observed
</th>
</tr></thead>
<tbody><tr>
<td style="text-align:left;">
601
</td>
<td style="text-align:right;">
0.6
</td>
<td style="text-align:right;">
6.283185
</td>
<td style="text-align:right;">
6.279010
</td>
<td style="text-align:right;">
6.180182
</td>
<td style="text-align:right;">
6.180991
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
0.7, 0.94
0, 0, 0, 0
</td>
<td style="text-align:right;">
<div class="line-block">6.28318</div>
</td>
</tr></tbody>
</table></div>
</div>
<div id="examples" class="section level3 unnumbered">
<h3>Examples<a class="anchor" aria-label="anchor" href="#examples"><i class="fas fa-link"></i></a>
</h3>
<p>Figure <a href="chapTappers1.html#fig:chapTappers7generatedODEsample1">7.10</a> shows the generated states and the discrete observations of the first model.</p>
<p>The parameters are indicated on top.
The top panel shows the the states as relative phase, that is, metronome states minus subject states and mapped to the interval <span class="math inline">\([-\pi, +\pi]\)</span>.
The dotted vertical line indicates one completed outphasing-inphasing cycle. Three such cycles are shown.
The circules show the observations as relative phase.</p>
<p>The bottom panel shows the states of all units as instantaneous periods.
Note that the metronomes form straight lines at 600 and 610 ms.</p>
<!-- ```{r echo=FALSE} -->
<!-- KD[c(1,21,3,23),] -->
<!-- ``` -->
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:chapTappers7generatedODEsample1"></span>
<img src="Figures/chapTappers_SimulatedStatesObservations_model_1_RelativePhase.png" alt="Dynamic model 1. Generated phase-functions with tapping data" width="49%"><img src="Figures/chapTappers_SimulatedStatesObservations_model_1_InstPeriod.png" alt="Dynamic model 1. Generated phase-functions with tapping data" width="49%"><p class="caption">
Figure 7.10: Dynamic model 1. Generated phase-functions with tapping data
</p>
</div>
<p>With the inclusion of delay lines in dynamic model 21, it can be observed that the two relative phase curves no longer overlap and that the relative phase is below zero, reflecting anticipation.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:chapTappers8generatedODEsample21"></span>
<img src="Figures/chapTappers_SimulatedStatesObservations_model_21_RelativePhase.png" alt="Dynamic system 21. Generated phase-functions with tapping data" width="49%"><img src="Figures/chapTappers_SimulatedStatesObservations_model_21_InstPeriod.png" alt="Dynamic system 21. Generated phase-functions with tapping data" width="49%"><p class="caption">
Figure 7.11: Dynamic system 21. Generated phase-functions with tapping data
</p>
</div>
<p>Additionally, it is important to note that the dynamic model is constrained to start at <span class="math inline">\(0 [rad]\)</span>. As indicated by the dashed red line, at the beginning of the second de-phasing/in-phasing cycle, the phase deviates from <span class="math inline">\(0 [rad]\)</span> but the dynamics over cycles becomes more stable (cf. cycle 2 and cycle 3). Note that the dashed red line marks the end of the first cycle.</p>
<p>These observations highlight the intricate dynamics and deviations from perfect synchrony in the tapping process, influenced by the coupling parameters, delay lines, and initial conditions of the dynamic system.
Using the interactive tool <a href="http://odetappers.shinyapps.io/odetappers2/">odetappers2</a>, figures can be replicated by setting the parameters accordingly.</p>
<!-- # Two finger tappers' entrainment (Part 1.2) -->
</div>
</div>
<div id="step-2.-from-observations-to-parameters-and-predictions" class="section level2" number="7.3">
<h2>
<span class="header-section-number">7.3</span> Step 2. From observations to parameters and predictions<a class="anchor" aria-label="anchor" href="#step-2.-from-observations-to-parameters-and-predictions"><i class="fas fa-link"></i></a>
</h2>
<p>After having specified the state-space model, we now turn our attention to estimation. We used the parameters specified in Table <a href="chapTappers1.html#tab:chapTappersKDtable">7.1</a> to generate (fake) observations.
Now we start from these observations and check whether we can retrieve the original parameters.
If this works, we have a super cool regression model with a dynamical system as predictor.</p>
<div id="observations" class="section level3 unnumbered">
<h3>Observations<a class="anchor" aria-label="anchor" href="#observations"><i class="fas fa-link"></i></a>
</h3>
<p>Let us first have a look at the observations, which is given as input to the state-space model.
It’s just a list of times at which a unit generates a tic or tap.
Recall that at these tic or tap times, the phase is just 0 [rad].
The observations are shown in table <a href="chapTappers1.html#tab:chapTappersInData">7.4</a>, where <code>time</code>, <code>names</code>, and <code>phase</code> have been selected from <code>Observations.</code></p>
<div class="inline-table"><table class="table table-striped" style="font-size: 10px; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">
<span id="tab:chapTappersInData">Table 7.4: </span>Simulated tappers data
</caption>
<thead><tr>
<th style="text-align:right;">
time
</th>
<th style="text-align:left;">
model
</th>
<th style="text-align:right;">
names_indicator
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
0.6
</td>
<td style="text-align:left;">
1
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
0.6
</td>
<td style="text-align:left;">
2
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
0.6
</td>
<td style="text-align:left;">
3
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
0.6
</td>
<td style="text-align:left;">
4
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
0.6
</td>
<td style="text-align:left;">
5
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:right;">
0.6
</td>
<td style="text-align:left;">
6
</td>
<td style="text-align:right;">
1
</td>
</tr>
</tbody>
</table></div>
</div>
<div id="likelihood-function" class="section level3 unnumbered">
<h3>Likelihood function<a class="anchor" aria-label="anchor" href="#likelihood-function"><i class="fas fa-link"></i></a>
</h3>
<p>To estimate the parameters of the state-space model, we have to specify how observations relate to the states. This is done by describing the likelihood function which we then want to optimize.
However, we already did all the work.</p>
<p>The likelihood function for states is:
<span class="math display">\[
\boldsymbol{\theta}_t = \boldsymbol{\theta}_{t-1} +  (\boldsymbol\omega + \boldsymbol\epsilon)\Delta{t}
\]</span>
where <span class="math inline">\(\boldsymbol{\theta}_t\)</span> is the state at continuous time point <span class="math inline">\(t\)</span>, <span class="math inline">\(\boldsymbol\omega\)</span> the eigen-frequencies, <span class="math inline">\(\boldsymbol\epsilon\)</span> the state error terms.</p>
<p>The likelihood function for observations is:
<span class="math display">\[
O_{u,t'} \sim F\boldsymbol{\theta_{t'}} + \textbf{v}
\]</span>
where <span class="math inline">\(O_u\)</span> is an observation of unit <span class="math inline">\(u\)</span> (<span class="math inline">\(\in {m1,s1,m2,s2})\)</span> at a discrete time point <span class="math inline">\(t'\)</span>, <span class="math inline">\(F\)</span> a function, and <span class="math inline">\(\textbf{v}\)</span> the observation noise.
The function <span class="math inline">\(F\)</span> specifies a modulo operator on the phase. This is needed because the <span class="math inline">\(\boldsymbol{\theta}\)</span> is continuously increasing over time. With <span class="math inline">\(F\)</span> we translate the phase to the interval <span class="math inline">\([-\pi,+\pi]\)</span> in order to be able to match it with zero, the phase value when an tick or tap event occurs at the time indicated by <span class="math inline">\(t'\)</span>.</p>
</div>
<div id="priors-for-likelihood-function" class="section level3 unnumbered">
<h3>Priors for likelihood function<a class="anchor" aria-label="anchor" href="#priors-for-likelihood-function"><i class="fas fa-link"></i></a>
</h3>
<p>The above likelihood function is not complete unless some boundaries and distributions for parameters are specified. They define a guided search space for the optimal fit between observations and model parameters.</p>
<p>The priors for the coupling (k) and phase delay (d) parameters are defined using some rough previous available knowledge.
As subjects are requested to follow their own metronome, the prior for the coupling strength parameter obeys a beta distribution with a peak towards 1. Accordingly, <span class="math inline">\(k\)</span>-parameters can be specified as <span class="math inline">\(beta(19,2)\)</span>.
Phase delay parameters are unknown but we assume that they are normal distributed with standard deviation 0.5: <span class="math inline">\(normal(.0,.5)\)</span>.
The prior for the observation noise parameter (<code>observation_std</code>), depends on the unit.
For metronome units, it is set to <span class="math inline">\(normal(0,.1)\)</span>.
For subject units, it is set to <span class="math inline">\(normal(0,1)\)</span>.
Finally, we work with priors for initial phases of <span class="math inline">\(s1\)</span> and <span class="math inline">\(s2\)</span> because we allow them to have an offset (in order to avoid starting from zero), with <span class="math inline">\(normal(.0,.15)\)</span>.
We also set boundaries for the parameters. Here is an overview:</p>
<p><span class="math display">\[
\tiny
\begin{aligned}
&amp; \textbf{priors for state equation}&amp;\\
&amp; ks1m1 &amp;\sim &amp;beta(19,2) &amp;\text{Prior for coupling strength s1 to m1, range: [0,1] }\\
&amp; ks2m2 &amp;\sim &amp;beta(19,2) &amp;\text{Prior for coupling strength s2 to m2, [0,1]  }\\\\
&amp; ds1m1 &amp;\sim &amp;normal(0,.5) &amp;\text{Prior for phase delay s1 to m1},[-\pi,\pi]\\
&amp; ds2m2 &amp;\sim &amp;normal(0,.5) &amp;\text{Prior for phase delay s2 to m2}, [-\pi,\pi]\\
&amp; ds1s2 &amp;\sim &amp;normal(0,.5) &amp;\text{Prior for phase delay s1 to s2}, [-\pi,\pi]\\
&amp; ds2s1 &amp;\sim &amp;normal(0,.5) &amp;\text{Prior for phase delay s2 to s1}, [-\pi,\pi]\\\\
&amp; \textbf{priors for observation equation}&amp;\\
&amp; observation\_std[1] &amp;\sim &amp;lognormal(0,.1) &amp;\text{Prior for observation noise of m1} \\
&amp; observation\_std[2] &amp;\sim &amp;lognormal(0,1) &amp;\text{Prior for observation noise of s1} \\
&amp; observation\_std[3] &amp;\sim &amp;lognormal(0,.1) &amp;\text{Prior for observation noise of m2} \\
&amp; observation\_std[4] &amp;\sim &amp;lognormal(0,1) &amp;\text{Prior for observation noise of s2} \\\\
&amp; \textbf{priors for initial offset}&amp;\\
&amp; \theta_{s1}(0) &amp;\sim &amp;normal(.0,.15) &amp;\text{Prior for initial phase offset of s1} \\
&amp; \theta_{s2}(0) &amp;\sim &amp;normal(.0,.15) &amp;\text{Prior for initial phase offset of s2} \\
\end{aligned}
\]</span></p>
</div>
<div id="running-stan" class="section level3" number="7.3.1">
<h3>
<span class="header-section-number">7.3.1</span> Running Stan<a class="anchor" aria-label="anchor" href="#running-stan"><i class="fas fa-link"></i></a>
</h3>
<p>The solution for the likelihood function is calculated with the MCMC-algorithms in Stan. Once we have the parameter values as posterior distributions, we can calculate new observations as posterior predictions.</p>
<p>Here we show in detail how it works, see also <code>Code/chapTappers/chapTappers_04_Modelling.R</code>.</p>
<p>The input to Stan is a list containing a specification of the number observations (<code>n_times</code>), the number of generated time instances (<code>n_gen_times</code>), the initial time (<code>time0</code>), value of the observed events (<code>observed</code>) (but recall that this is always 0), the time at which the phase appears (<code>time</code>), the generated time instances (<code>time_gen</code>), and the unit indicator (<code>name_indicator</code>) (1=<span class="math inline">\(m1\)</span>, 2=<span class="math inline">\(s1\)</span>, 3= <span class="math inline">\(m2\)</span>, 4= <span class="math inline">\(s2\)</span>). This is how the list looks like:</p>
<pre><code>## List of 7
##  $ n_times        : int 244
##  $ n_gen_times    : num 100
##  $ time0          : num 0
##  $ observed       : num [1:244] -0.00906 -0.00906 -0.00875 -0.01047 -0.00461 ...
##  $ time           : num [1:244] 0.00156 0.00911 0.59189 0.599 0.6059 ...
##  $ time_gen       : num [1:100] 0.0001 0.3698 0.7395 1.1092 1.4789 ...
##  $ names_indicator: num [1:244] 4 4 2 1 4 3 1 2 4 3 ...</code></pre>
<p>This input can be sent to Stan from inside R using the function <code>stan</code> from the R-package <code>rstan</code>. It sends the program, contained in <code>filenameStanCode</code> to the sampler-algorithms, which creates the posterior of the likelihood function and priors.</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">filenameStanCode</span> <span class="op">=</span> <span class="st">"Code/chapTappers/chapTappers_StateSpaceModel.stan"</span></span>
<span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">stan</span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">StanData</span>, <span class="co"># the data as input to stan</span></span>
<span>  file <span class="op">=</span> <span class="va">filenameStanCode</span>, <span class="co"># the filename containing the stan code</span></span>
<span>  thin <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  iter <span class="op">=</span> <span class="fl">6000</span>,</span>
<span>  warmup <span class="op">=</span> <span class="fl">2000</span>,</span>
<span>  cores <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  chain <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div id="state-equations-1" class="section level3 unnumbered">
<h3>State equations<a class="anchor" aria-label="anchor" href="#state-equations-1"><i class="fas fa-link"></i></a>
</h3>
<p>The code in <code>filenameStancode</code> contains several blocks.
The states equations in the syntax of Stan are:</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="chapTappers1.html#cb53-1" tabindex="-1"></a>functions {</span>
<span id="cb53-2"><a href="chapTappers1.html#cb53-2" tabindex="-1"></a>  vector <span class="fu">do_dt</span>(real t, vector y,  real ks1m1, real ks2m2,  real ds1m1, real ds2m2,</span>
<span id="cb53-3"><a href="chapTappers1.html#cb53-3" tabindex="-1"></a>               real ds1s2, real ds2s1){</span>
<span id="cb53-4"><a href="chapTappers1.html#cb53-4" tabindex="-1"></a>    real pi600 <span class="ot">=</span> <span class="dv">2</span><span class="sc">*</span><span class="fu">pi</span>()<span class="sc">/</span>.<span class="dv">6</span>; <span class="sc">/</span><span class="er">/</span> Eigenfrequency s1, m1</span>
<span id="cb53-5"><a href="chapTappers1.html#cb53-5" tabindex="-1"></a>    real pi610 <span class="ot">=</span> <span class="dv">2</span><span class="sc">*</span><span class="fu">pi</span>()<span class="sc">/</span>.<span class="dv">61</span>;  <span class="sc">/</span><span class="er">/</span> Eigenfrequency s2, m2</span>
<span id="cb53-6"><a href="chapTappers1.html#cb53-6" tabindex="-1"></a></span>
<span id="cb53-7"><a href="chapTappers1.html#cb53-7" tabindex="-1"></a>    real dm1dt <span class="ot">=</span> pi600;</span>
<span id="cb53-8"><a href="chapTappers1.html#cb53-8" tabindex="-1"></a>    real ds1dt <span class="ot">=</span> pi600 <span class="sc">+</span> .<span class="dv">5</span><span class="sc">*</span>(ks1m1<span class="sc">*</span><span class="fu">sin</span>(y[<span class="dv">1</span>]<span class="sc">-</span>y[<span class="dv">2</span>]<span class="sc">+</span>ds1m1)<span class="sc">+</span>(<span class="dv">1</span><span class="sc">-</span>ks1m1)<span class="sc">*</span><span class="fu">sin</span>(y[<span class="dv">4</span>]<span class="sc">-</span>y[<span class="dv">2</span>]<span class="sc">+</span>ds1s2));</span>
<span id="cb53-9"><a href="chapTappers1.html#cb53-9" tabindex="-1"></a>    real dm2dt <span class="ot">=</span> pi610;</span>
<span id="cb53-10"><a href="chapTappers1.html#cb53-10" tabindex="-1"></a>    real ds2dt <span class="ot">=</span> pi610 <span class="sc">+</span> .<span class="dv">5</span><span class="sc">*</span>(ks2m2<span class="sc">*</span><span class="fu">sin</span>(y[<span class="dv">3</span>]<span class="sc">-</span>y[<span class="dv">4</span>]<span class="sc">+</span>ds2m2)<span class="sc">+</span>(<span class="dv">1</span><span class="sc">-</span>ks2m2)<span class="sc">*</span><span class="fu">sin</span>(y[<span class="dv">2</span>]<span class="sc">-</span>y[<span class="dv">4</span>]<span class="sc">+</span>ds2s1));</span>
<span id="cb53-11"><a href="chapTappers1.html#cb53-11" tabindex="-1"></a>    return <span class="fu">to_vector</span>([dm1dt,ds1dt,dm2dt,ds2dt]);</span>
<span id="cb53-12"><a href="chapTappers1.html#cb53-12" tabindex="-1"></a>  }</span>
<span id="cb53-13"><a href="chapTappers1.html#cb53-13" tabindex="-1"></a>}</span></code></pre></div>
<p>The call to this function is defined as:</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="chapTappers1.html#cb54-1" tabindex="-1"></a>vector[<span class="dv">4</span>] omega[n_times] <span class="ot">=</span> <span class="fu">ode_rk45</span>(do_dt, y0, time0, time,</span>
<span id="cb54-2"><a href="chapTappers1.html#cb54-2" tabindex="-1"></a>        ks1m1, ks2m2, ds1m1, ds2m2, ds1s2, ds2s1) ;</span></code></pre></div>
<p><code>Omega</code> is an array of vectors containing the state values of <span class="math inline">\(m1\)</span>, <span class="math inline">\(s1\)</span>, <span class="math inline">\(m2\)</span>, <span class="math inline">\(s2\)</span> at all <code>n_times</code> tick and tap events. With omega we thus get the phases of all units, as well as distributions for the estimated parameters <span class="math inline">\(ks1m1, ks2m2, ds1m1, ds2m2, ds1s2\)</span>, and <span class="math inline">\(ds2s1\)</span>.</p>
<p>This works because we put it in a likelihood function where observations are linked with states.</p>
<p>The function can be understood as follows. Any tick and tap <span class="math inline">\(n\)</span>, the observed value at <code>[n]</code> (which is zero, or close to zero) has the state value as its mean, plus a value drawn from a normal distribution with a to-be-estimated standard deviation of the corresponding unit.</p>
<p>Note that the state value is a single value for <code>names_indicator[n]</code> taken at event <span class="math inline">\(n\)</span>, of the array <code>omega</code>, after applying a modulo <span class="math inline">\(2\pi\)</span> rotation so that the phase occurs in the interval <span class="math inline">\([-\pi,+\pi]\)</span>. In other words, when an observed value is considered, it is fitted by updating the states with a call to omega. The returned state is then mixed with noise to fit the observation.</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="chapTappers1.html#cb55-1" tabindex="-1"></a><span class="cf">for</span> (n <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_times){</span>
<span id="cb55-2"><a href="chapTappers1.html#cb55-2" tabindex="-1"></a>  state <span class="ot">=</span> <span class="fu">fmod</span>(omega[n,names_indicator[n]] <span class="sc">+</span> <span class="fu">pi</span>(), pi2 ) <span class="sc">-</span> <span class="fu">pi</span>();</span>
<span id="cb55-3"><a href="chapTappers1.html#cb55-3" tabindex="-1"></a>  <span class="sc">/</span><span class="er">/</span> single value returned here because we have only one observation per time</span>
<span id="cb55-4"><a href="chapTappers1.html#cb55-4" tabindex="-1"></a>  observed[n] <span class="sc">~</span> <span class="fu">normal</span>(state, observation_std[names_indicator[n]]);</span>
<span id="cb55-5"><a href="chapTappers1.html#cb55-5" tabindex="-1"></a>  <span class="sc">/</span><span class="er">/</span> names_indicator defines which unit is active at n</span>
<span id="cb55-6"><a href="chapTappers1.html#cb55-6" tabindex="-1"></a>}</span>
<span id="cb55-7"><a href="chapTappers1.html#cb55-7" tabindex="-1"></a><span class="er">}</span></span></code></pre></div>
</div>
<div id="posterior-predictions-or-generated-states-and-observations" class="section level3 unnumbered">
<h3>Posterior predictions, or generated states and observations<a class="anchor" aria-label="anchor" href="#posterior-predictions-or-generated-states-and-observations"><i class="fas fa-link"></i></a>
</h3>
<p>Given the solution of the likelihood function, kown as the posterior, we can generate new observations.</p>
<p>This is directly calculated in Stan, using a block called <code>generated quantities</code>.
First, we calculate the states by a call to the state equation.
This generates the vector <code>states_generated</code> as an array of vectors.
The length of the array is now <code>n_gen_times</code>, and the vector holds the state values of the units at each point in this array. Obviously, we could have used exactly the same times as the observation events which we gave as input to the system.
Here, however, we specified time points between those events. In fact, we want the time points at a given sampling interval so that we get 100 time points per outphasing-inphasing cycle of 36.6 seconds.</p>
<p>Secondly, once we have the states generated, we calculate the observations for each unit separately at each time point <code>n</code>. These observations are drawn from a normal distribution with given mean and standard deviation.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="chapTappers1.html#cb56-1" tabindex="-1"></a>generated quantities {</span>
<span id="cb56-2"><a href="chapTappers1.html#cb56-2" tabindex="-1"></a>  vector[<span class="dv">4</span>] observations_generated[n_gen_times];</span>
<span id="cb56-3"><a href="chapTappers1.html#cb56-3" tabindex="-1"></a>  vector[<span class="dv">4</span>] states_generated[n_gen_times] <span class="ot">=</span> <span class="fu">ode_rk45</span>(do_dt, y0, time0, time_gen, ks1m1, ks2m2, ds1m1, ds2m2,ds1s2,ds2s1) ;</span>
<span id="cb56-4"><a href="chapTappers1.html#cb56-4" tabindex="-1"></a>  <span class="cf">for</span> (n <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_gen_times){</span>
<span id="cb56-5"><a href="chapTappers1.html#cb56-5" tabindex="-1"></a>    observations_generated[n,<span class="dv">1</span>] <span class="ot">=</span> <span class="fu">normal_rng</span>(states_generated[n,<span class="dv">1</span>],observation_std[<span class="dv">1</span>]);</span>
<span id="cb56-6"><a href="chapTappers1.html#cb56-6" tabindex="-1"></a>    observations_generated[n,<span class="dv">2</span>] <span class="ot">=</span> <span class="fu">normal_rng</span>(states_generated[n,<span class="dv">2</span>],observation_std[<span class="dv">2</span>]);</span>
<span id="cb56-7"><a href="chapTappers1.html#cb56-7" tabindex="-1"></a>    observations_generated[n,<span class="dv">3</span>] <span class="ot">=</span> <span class="fu">normal_rng</span>(states_generated[n,<span class="dv">3</span>],observation_std[<span class="dv">3</span>]);</span>
<span id="cb56-8"><a href="chapTappers1.html#cb56-8" tabindex="-1"></a>    observations_generated[n,<span class="dv">4</span>] <span class="ot">=</span> <span class="fu">normal_rng</span>(states_generated[n,<span class="dv">4</span>],observation_std[<span class="dv">4</span>]);</span>
<span id="cb56-9"><a href="chapTappers1.html#cb56-9" tabindex="-1"></a>  }</span></code></pre></div>
<p>Basically, that’s all there is to modelling in Stan.</p>
</div>
<div id="summary-stan-code" class="section level3 unnumbered">
<h3>Summary Stan code<a class="anchor" aria-label="anchor" href="#summary-stan-code"><i class="fas fa-link"></i></a>
</h3>
<p>The code is rather compact and apart from the variable definitions and constraints, it is not more than a few lines.
Here we reproduce it entirely.
The code is also found in Code/chapTappers/chapTappers_StateSpaceModel.stan.<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;Admitted, it takes some effort to get into the philosophy of probabilistic programming. Our sources were the Stan manuals available at &lt;a href="https://mc-stan.org/users/documentation/" class="uri"&gt;https://mc-stan.org/users/documentation/&lt;/a&gt;), and the study of Bob Carpenter on the predator-pray population dynamics available at &lt;a href="https://mc-stan.org/users/documentation/case-studies/lotka-volterra-predator-prey.html" class="uri"&gt;https://mc-stan.org/users/documentation/case-studies/lotka-volterra-predator-prey.html&lt;/a&gt;&lt;/p&gt;'><sup>31</sup></a>.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode stan"><code class="sourceCode stan"><span id="cb57-1"><a href="chapTappers1.html#cb57-1" tabindex="-1"></a><span class="kw">functions</span> {</span>
<span id="cb57-2"><a href="chapTappers1.html#cb57-2" tabindex="-1"></a>  <span class="dt">vector</span> do_dt(<span class="dt">real</span> t, <span class="dt">vector</span> y,  <span class="dt">real</span> ks1m1, <span class="dt">real</span> ks2m2,  <span class="dt">real</span> ds1m1, <span class="dt">real</span> ds2m2,</span>
<span id="cb57-3"><a href="chapTappers1.html#cb57-3" tabindex="-1"></a>  <span class="dt">real</span> ds1s2, <span class="dt">real</span> ds2s1){</span>
<span id="cb57-4"><a href="chapTappers1.html#cb57-4" tabindex="-1"></a>    <span class="dt">real</span> pi600 = <span class="dv">2</span>*pi()/.<span class="dv">6</span>; <span class="co">// Eigenfrequency s1, m1</span></span>
<span id="cb57-5"><a href="chapTappers1.html#cb57-5" tabindex="-1"></a>    <span class="dt">real</span> pi610 = <span class="dv">2</span>*pi()/.<span class="dv">61</span>;</span>
<span id="cb57-6"><a href="chapTappers1.html#cb57-6" tabindex="-1"></a>    <span class="dt">real</span> dm1dt = pi600; </span>
<span id="cb57-7"><a href="chapTappers1.html#cb57-7" tabindex="-1"></a>    <span class="dt">real</span> ds1dt = dm1dt + (ks1m1 * sin(y[<span class="dv">1</span>] - y[<span class="dv">2</span>] + ds1m1) + </span>
<span id="cb57-8"><a href="chapTappers1.html#cb57-8" tabindex="-1"></a>      (<span class="dv">1</span>-ks1m1) * sin(y[<span class="dv">4</span>] - y[<span class="dv">2</span>] + ds1s2)  ); </span>
<span id="cb57-9"><a href="chapTappers1.html#cb57-9" tabindex="-1"></a>    <span class="dt">real</span> dm2dt = pi610;</span>
<span id="cb57-10"><a href="chapTappers1.html#cb57-10" tabindex="-1"></a>    <span class="dt">real</span> ds2dt = dm2dt + (ks2m2 * sin(y[<span class="dv">3</span>] - y[<span class="dv">4</span>] + ds2m2) + </span>
<span id="cb57-11"><a href="chapTappers1.html#cb57-11" tabindex="-1"></a>        (<span class="dv">1</span>-ks2m2) * sin(y[<span class="dv">2</span>] - y[<span class="dv">4</span>] + ds2s1)  ); </span>
<span id="cb57-12"><a href="chapTappers1.html#cb57-12" tabindex="-1"></a>        <span class="cf">return</span> to_vector([dm1dt,ds1dt,dm2dt,ds2dt]);</span>
<span id="cb57-13"><a href="chapTappers1.html#cb57-13" tabindex="-1"></a>  }</span>
<span id="cb57-14"><a href="chapTappers1.html#cb57-14" tabindex="-1"></a>}</span>
<span id="cb57-15"><a href="chapTappers1.html#cb57-15" tabindex="-1"></a></span>
<span id="cb57-16"><a href="chapTappers1.html#cb57-16" tabindex="-1"></a><span class="kw">data</span> {</span>
<span id="cb57-17"><a href="chapTappers1.html#cb57-17" tabindex="-1"></a>  <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">1</span>&gt; n_times; <span class="co">// Number of time steps minus one</span></span>
<span id="cb57-18"><a href="chapTappers1.html#cb57-18" tabindex="-1"></a>  <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">1</span>&gt; n_gen_times;</span>
<span id="cb57-19"><a href="chapTappers1.html#cb57-19" tabindex="-1"></a>  <span class="dt">real</span> time0;</span>
<span id="cb57-20"><a href="chapTappers1.html#cb57-20" tabindex="-1"></a>  <span class="dt">array</span>[n_times] <span class="dt">real</span> observed; <span class="co">// Observed taps, minus initial state</span></span>
<span id="cb57-21"><a href="chapTappers1.html#cb57-21" tabindex="-1"></a>  <span class="dt">array</span>[n_times] <span class="dt">real</span> time ;</span>
<span id="cb57-22"><a href="chapTappers1.html#cb57-22" tabindex="-1"></a>  <span class="dt">array</span>[n_times] <span class="dt">int</span>&lt;<span class="kw">lower</span>=<span class="dv">1</span>&gt; names_indicator; <span class="co">// names of oscillators</span></span>
<span id="cb57-23"><a href="chapTappers1.html#cb57-23" tabindex="-1"></a>  <span class="dt">array</span>[n_gen_times] <span class="dt">real</span> time_gen; <span class="co">// times to generate simulated data for</span></span>
<span id="cb57-24"><a href="chapTappers1.html#cb57-24" tabindex="-1"></a>}</span>
<span id="cb57-25"><a href="chapTappers1.html#cb57-25" tabindex="-1"></a></span>
<span id="cb57-26"><a href="chapTappers1.html#cb57-26" tabindex="-1"></a><span class="kw">parameters</span> {</span>
<span id="cb57-27"><a href="chapTappers1.html#cb57-27" tabindex="-1"></a>  <span class="dt">real</span>&lt;<span class="kw">lower</span> = <span class="dv">0</span>,<span class="kw">upper</span>=<span class="dv">1</span>&gt; ks1m1;</span>
<span id="cb57-28"><a href="chapTappers1.html#cb57-28" tabindex="-1"></a>  <span class="dt">real</span>&lt;<span class="kw">lower</span> = <span class="dv">0</span>,<span class="kw">upper</span>=<span class="dv">1</span>&gt; ks2m2;</span>
<span id="cb57-29"><a href="chapTappers1.html#cb57-29" tabindex="-1"></a>  <span class="dt">real</span> &lt;<span class="kw">lower</span> = -pi(),<span class="kw">upper</span>=pi()&gt; ds1m1; <span class="co">// 5_aug</span></span>
<span id="cb57-30"><a href="chapTappers1.html#cb57-30" tabindex="-1"></a>  <span class="dt">real</span> &lt;<span class="kw">lower</span> = -pi(),<span class="kw">upper</span>=pi()&gt; ds2m2; <span class="co">// 5_aug</span></span>
<span id="cb57-31"><a href="chapTappers1.html#cb57-31" tabindex="-1"></a>  <span class="dt">real</span> &lt;<span class="kw">lower</span> = -pi(),<span class="kw">upper</span>=pi()&gt; ds1s2; <span class="co">// 5_aug</span></span>
<span id="cb57-32"><a href="chapTappers1.html#cb57-32" tabindex="-1"></a>  <span class="dt">real</span> &lt;<span class="kw">lower</span> = -pi(),<span class="kw">upper</span>=pi()&gt; ds2s1; <span class="co">// 5_aug</span></span>
<span id="cb57-33"><a href="chapTappers1.html#cb57-33" tabindex="-1"></a>  <span class="co">// real &lt;lower = 0, upper = 20&gt; kappa[4];</span></span>
<span id="cb57-34"><a href="chapTappers1.html#cb57-34" tabindex="-1"></a>  <span class="dt">array</span>[<span class="dv">4</span>] <span class="dt">real</span>&lt;<span class="kw">lower</span>=<span class="dv">0</span>&gt; observation_std; <span class="co">// Variance of observation</span></span>
<span id="cb57-35"><a href="chapTappers1.html#cb57-35" tabindex="-1"></a>  <span class="dt">real</span> y0_s1;</span>
<span id="cb57-36"><a href="chapTappers1.html#cb57-36" tabindex="-1"></a>  <span class="dt">real</span> y0_s2;</span>
<span id="cb57-37"><a href="chapTappers1.html#cb57-37" tabindex="-1"></a>}</span>
<span id="cb57-38"><a href="chapTappers1.html#cb57-38" tabindex="-1"></a></span>
<span id="cb57-39"><a href="chapTappers1.html#cb57-39" tabindex="-1"></a><span class="kw">transformed parameters</span> {</span>
<span id="cb57-40"><a href="chapTappers1.html#cb57-40" tabindex="-1"></a>  <span class="dt">vector</span>[<span class="dv">4</span>] y0 = [.<span class="dv">0</span>,y0_s1,.<span class="dv">0</span>,y0_s2]' ;</span>
<span id="cb57-41"><a href="chapTappers1.html#cb57-41" tabindex="-1"></a>  <span class="dt">array</span>[n_times] <span class="dt">vector</span>[<span class="dv">4</span>] omega = ode_rk45(do_dt, y0, time0, time, ks1m1, ks2m2, ds1m1, ds2m2, ds1s2, ds2s1) ;</span>
<span id="cb57-42"><a href="chapTappers1.html#cb57-42" tabindex="-1"></a>}</span>
<span id="cb57-43"><a href="chapTappers1.html#cb57-43" tabindex="-1"></a></span>
<span id="cb57-44"><a href="chapTappers1.html#cb57-44" tabindex="-1"></a><span class="kw">model</span> {</span>
<span id="cb57-45"><a href="chapTappers1.html#cb57-45" tabindex="-1"></a>  ks1m1 ~ beta(<span class="dv">19</span>,<span class="dv">2</span>) ;</span>
<span id="cb57-46"><a href="chapTappers1.html#cb57-46" tabindex="-1"></a>  ks2m2 ~ beta(<span class="dv">19</span>,<span class="dv">2</span>) ;</span>
<span id="cb57-47"><a href="chapTappers1.html#cb57-47" tabindex="-1"></a>  ds1m1 ~ normal(.<span class="dv">0</span>,.<span class="dv">5</span>) ;</span>
<span id="cb57-48"><a href="chapTappers1.html#cb57-48" tabindex="-1"></a>  ds2m2 ~ normal(.<span class="dv">0</span>,.<span class="dv">5</span>) ;</span>
<span id="cb57-49"><a href="chapTappers1.html#cb57-49" tabindex="-1"></a>  ds1s2 ~ normal(.<span class="dv">0</span>,.<span class="dv">5</span>) ;</span>
<span id="cb57-50"><a href="chapTappers1.html#cb57-50" tabindex="-1"></a>  ds2s1 ~ normal(.<span class="dv">0</span>,.<span class="dv">5</span>) ;</span>
<span id="cb57-51"><a href="chapTappers1.html#cb57-51" tabindex="-1"></a>  observation_std[<span class="dv">1</span>] ~ normal(.<span class="dv">0</span>,.<span class="dv">1</span>) ;</span>
<span id="cb57-52"><a href="chapTappers1.html#cb57-52" tabindex="-1"></a>  observation_std[<span class="dv">2</span>] ~ normal(.<span class="dv">0</span>,<span class="dv">1</span>) ;</span>
<span id="cb57-53"><a href="chapTappers1.html#cb57-53" tabindex="-1"></a>  observation_std[<span class="dv">3</span>] ~ normal(.<span class="dv">0</span>,.<span class="dv">1</span>) ;</span>
<span id="cb57-54"><a href="chapTappers1.html#cb57-54" tabindex="-1"></a>  observation_std[<span class="dv">4</span>] ~ normal(.<span class="dv">0</span>,<span class="dv">1</span>) ;</span>
<span id="cb57-55"><a href="chapTappers1.html#cb57-55" tabindex="-1"></a>  y0_s1 ~ normal(.<span class="dv">0</span>,.<span class="dv">15</span>) ;</span>
<span id="cb57-56"><a href="chapTappers1.html#cb57-56" tabindex="-1"></a>  y0_s2 ~ normal(.<span class="dv">0</span>,.<span class="dv">15</span>) ;</span>
<span id="cb57-57"><a href="chapTappers1.html#cb57-57" tabindex="-1"></a>  <span class="dt">real</span> pi2 = <span class="dv">2</span>*pi() ;</span>
<span id="cb57-58"><a href="chapTappers1.html#cb57-58" tabindex="-1"></a>  <span class="dt">real</span> state;</span>
<span id="cb57-59"><a href="chapTappers1.html#cb57-59" tabindex="-1"></a>  <span class="cf">for</span> (n <span class="cf">in</span> <span class="dv">1</span>:n_times){</span>
<span id="cb57-60"><a href="chapTappers1.html#cb57-60" tabindex="-1"></a>    state = fmod(omega[n,names_indicator[n]] + pi(), pi2 ) - pi(); </span>
<span id="cb57-61"><a href="chapTappers1.html#cb57-61" tabindex="-1"></a>    <span class="co">// single value returned here because we have only one observation per time</span></span>
<span id="cb57-62"><a href="chapTappers1.html#cb57-62" tabindex="-1"></a>    observed[n] ~ normal(state, (observation_std[names_indicator[n]]));</span>
<span id="cb57-63"><a href="chapTappers1.html#cb57-63" tabindex="-1"></a>    <span class="co">// names_indicator defines which unit is active at n</span></span>
<span id="cb57-64"><a href="chapTappers1.html#cb57-64" tabindex="-1"></a>  }</span>
<span id="cb57-65"><a href="chapTappers1.html#cb57-65" tabindex="-1"></a>}</span>
<span id="cb57-66"><a href="chapTappers1.html#cb57-66" tabindex="-1"></a></span>
<span id="cb57-67"><a href="chapTappers1.html#cb57-67" tabindex="-1"></a><span class="kw">generated quantities</span> {</span>
<span id="cb57-68"><a href="chapTappers1.html#cb57-68" tabindex="-1"></a>  <span class="dt">array</span>[n_gen_times] <span class="dt">vector</span>[<span class="dv">4</span>] observations_generated;</span>
<span id="cb57-69"><a href="chapTappers1.html#cb57-69" tabindex="-1"></a>  <span class="dt">array</span>[n_gen_times] <span class="dt">vector</span>[<span class="dv">4</span>] states_generated = ode_rk45(do_dt, y0, time0, time_gen, ks1m1, ks2m2, ds1m1, ds2m2,ds1s2,ds2s1) ;</span>
<span id="cb57-70"><a href="chapTappers1.html#cb57-70" tabindex="-1"></a>  <span class="cf">for</span> (n <span class="cf">in</span> <span class="dv">1</span>:n_gen_times){</span>
<span id="cb57-71"><a href="chapTappers1.html#cb57-71" tabindex="-1"></a>    observations_generated[n,<span class="dv">1</span>] = normal_rng(states_generated[n,<span class="dv">1</span>],observation_std[<span class="dv">1</span>]);</span>
<span id="cb57-72"><a href="chapTappers1.html#cb57-72" tabindex="-1"></a>    observations_generated[n,<span class="dv">2</span>] = normal_rng(states_generated[n,<span class="dv">2</span>],observation_std[<span class="dv">2</span>]);</span>
<span id="cb57-73"><a href="chapTappers1.html#cb57-73" tabindex="-1"></a>    observations_generated[n,<span class="dv">3</span>] = normal_rng(states_generated[n,<span class="dv">3</span>],observation_std[<span class="dv">3</span>]);</span>
<span id="cb57-74"><a href="chapTappers1.html#cb57-74" tabindex="-1"></a>    observations_generated[n,<span class="dv">4</span>] = normal_rng(states_generated[n,<span class="dv">4</span>],observation_std[<span class="dv">4</span>]);</span>
<span id="cb57-75"><a href="chapTappers1.html#cb57-75" tabindex="-1"></a>  }</span>
<span id="cb57-76"><a href="chapTappers1.html#cb57-76" tabindex="-1"></a>}</span></code></pre></div>
<p>Note that this is a Stan file, which is then called from within R, as in the following example code. See <code>Code/chapTappers/chapTappers_04_Modelling.R</code>.</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>    <span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">stan</span><span class="op">(</span></span>
<span>      data <span class="op">=</span> <span class="va">StanData</span>,</span>
<span>      file <span class="op">=</span> <span class="va">filenameStancode</span>,</span>
<span>      <span class="co">#verbose = FALSE,</span></span>
<span>      init <span class="op">=</span> <span class="fl">0</span>,</span>
<span>      thin <span class="op">=</span> <span class="fl">2</span>,</span>
<span>      iter <span class="op">=</span> <span class="fl">6000</span>,</span>
<span>      warmup <span class="op">=</span> <span class="fl">2000</span>,</span>
<span>      cores <span class="op">=</span> <span class="fl">2</span>,</span>
<span>      chain <span class="op">=</span> <span class="fl">2</span></span>
<span>    <span class="op">)</span></span></code></pre></div>
</div>
</div>
<div id="step-3.-evaluation" class="section level2" number="7.4">
<h2>
<span class="header-section-number">7.4</span> Step 3. Evaluation<a class="anchor" aria-label="anchor" href="#step-3.-evaluation"><i class="fas fa-link"></i></a>
</h2>
<p>The code for calculating the posterior of 40 dynamic models can be found in Code/chapTappers/chapTappers_04_Modelling. It involves all steps seen so far.
From each posterior, we then extract the posterior parameter distribution and we compare them with the designed parameters.</p>
<div id="evaluating-the-posterior-distributions" class="section level3 unnumbered">
<h3>Evaluating the posterior distributions<a class="anchor" aria-label="anchor" href="#evaluating-the-posterior-distributions"><i class="fas fa-link"></i></a>
</h3>
<p>Figure <a href="chapTappers1.html#fig:chapTappers12ODEfittedParametersKD">7.12</a> shows the posterior distributions (as estimated mean and 95% CI) and the designed parameters (as circles).
The top panel shows the <em>coupling strengths</em> of the 40 dynamic models tested.
White circles would have implied that there is no match of designed and estimated parameter values.
Instead we see all circles filled, which suggests that the coupling strengths have been correctly retrieved. Recall that the designed coupling strengths are exactly the same for models 1 to 20, and models 21 to 40.
The middle panel shows the phase delay to the metronome.
Recall that it is zero in models 1 to 20 and randomly assigned in models 21 to 40.
The bottom panel shows the phase delay to the partner.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:chapTappers12ODEfittedParametersKD"></span>
<img src="Figures/chapTappers_PosteriorSummary_States_fig.png" alt="Posterior sommary of fitted parameters of the state equation, compared to designed parameters (cicles). Top: coupling strength. Middle: phase delay to metronome. Bottom: phase delay to partner" width="100%"><p class="caption">
Figure 7.12: Posterior sommary of fitted parameters of the state equation, compared to designed parameters (cicles). Top: coupling strength. Middle: phase delay to metronome. Bottom: phase delay to partner
</p>
</div>
<p><!-- ```{r chapTappers13ODEfittedParametersD, echo=FALSE, fig.cap="(a) Posterior distributions of fitted delay parameters D, compared to defined D (cicles). (b) Error as the difference between the mean value of the posterior distribution (called: fitted value) and the designed value. The boxplot shows the 25%, 50%, and 75% quantiles", out.width='35%', fig.asp=.75, fig.align='center', fig.show = "hold"} --></p>
<p><!-- knitr::include_graphics(c("Figures/chapTappers_OverviewODE_fittedParametersD_13_july.png", -->
<!--                           "Figures/chapTappers_OverviewODE_fittedParametersErrorD_13_july.png")) -->
<!-- # \@ref(fig:chapTappers12ODEfittedParametersD) -->
<!-- ``` --></p>
<p>In table <a href="chapTappers1.html#tab:chapTappers15KDcompare3">7.5</a> we show the designed and fitted parameters of all models, as well as their difference.</p>
<div class="inline-table"><table class="table table-striped" style="font-size: 9px; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">
<span id="tab:chapTappers15KDcompare3">Table 7.5: </span>Defined and fitted parameters of 40 dynamic systems.
Column names have the following coding convention:
Defined parameters are: <span class="math inline">\(k1 = ks1m1\)</span>, <span class="math inline">\(k2 = ks2m2\)</span>,
<span class="math inline">\(d1 = ds1m1\)</span>, <span class="math inline">\(d2 = ds2m2\)</span>, <span class="math inline">\(d3 = ds1s2\)</span>, <span class="math inline">\(d4 = ds2s1\)</span>.
Fitted parameters are: <span class="math inline">\(K1 = ks1m1\)</span>,
<span class="math inline">\(K2 = ks2m2\)</span>,
<span class="math inline">\(D1 = ds1m1\)</span>,
<span class="math inline">\(D2 = ds2m2\)</span>,
<span class="math inline">\(D3 = ds1s2\)</span>,
<span class="math inline">\(D4 = ds2s1\)</span>.
Differences are:
<span class="math inline">\(Kk1 = K1 - k1\)</span>,
<span class="math inline">\(Kk2 = K2 - k2\)</span>,
<span class="math inline">\(Dd1 = D1 - d1\)</span> and
<span class="math inline">\(Dd2 = D2 - d1\)</span>
</caption>
<thead>
<tr>
<th style="empty-cells: hide;border-bottom:hidden;" colspan="1">
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="6">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
defined
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="6">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
fitted
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="4">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
fitted - defined
</div>
</th>
</tr>
<tr>
<th style="text-align:right;">
sim
</th>
<th style="text-align:right;">
k1
</th>
<th style="text-align:right;">
k2
</th>
<th style="text-align:right;">
d1
</th>
<th style="text-align:right;">
d2
</th>
<th style="text-align:right;">
d3
</th>
<th style="text-align:right;">
d4
</th>
<th style="text-align:right;">
K1
</th>
<th style="text-align:right;">
K2
</th>
<th style="text-align:right;">
D1
</th>
<th style="text-align:right;">
D2
</th>
<th style="text-align:right;">
D3
</th>
<th style="text-align:right;">
D4
</th>
<th style="text-align:right;">
Kk1
</th>
<th style="text-align:right;">
Kk2
</th>
<th style="text-align:right;">
Dd1
</th>
<th style="text-align:right;">
Dd2
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;border-right:1px solid;">
1
</td>
<td style="text-align:right;">
0.70
</td>
<td style="text-align:right;border-right:1px solid;">
0.94
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;border-right:1px solid;border-right:1px solid;">
0
</td>
<td style="text-align:right;">
0.70
</td>
<td style="text-align:right;border-right:1px solid;">
0.93
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
-0.01
</td>
<td style="text-align:right;border-right:1px solid;">
0.18
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;border-right:1px solid;">
-0.01
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;border-right:1px solid;">
0.00
</td>
</tr>
<tr>
<td style="text-align:right;border-right:1px solid;">
2
</td>
<td style="text-align:right;">
0.81
</td>
<td style="text-align:right;border-right:1px solid;">
0.76
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;border-right:1px solid;border-right:1px solid;">
0
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;border-right:1px solid;">
0.76
</td>
<td style="text-align:right;">
-0.01
</td>
<td style="text-align:right;">
0.02
</td>
<td style="text-align:right;">
-0.12
</td>
<td style="text-align:right;border-right:1px solid;">
0.05
</td>
<td style="text-align:right;">
-0.01
</td>
<td style="text-align:right;border-right:1px solid;">
0.00
</td>
<td style="text-align:right;">
-0.01
</td>
<td style="text-align:right;border-right:1px solid;">
0.02
</td>
</tr>
<tr>
<td style="text-align:right;border-right:1px solid;">
3
</td>
<td style="text-align:right;">
0.79
</td>
<td style="text-align:right;border-right:1px solid;">
0.81
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;border-right:1px solid;border-right:1px solid;">
0
</td>
<td style="text-align:right;">
0.79
</td>
<td style="text-align:right;border-right:1px solid;">
0.82
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
-0.02
</td>
<td style="text-align:right;border-right:1px solid;">
0.06
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;border-right:1px solid;">
0.01
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;border-right:1px solid;">
0.00
</td>
</tr>
<tr>
<td style="text-align:right;border-right:1px solid;">
4
</td>
<td style="text-align:right;">
0.62
</td>
<td style="text-align:right;border-right:1px solid;">
0.70
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;border-right:1px solid;border-right:1px solid;">
0
</td>
<td style="text-align:right;">
0.62
</td>
<td style="text-align:right;border-right:1px solid;">
0.70
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.01
</td>
<td style="text-align:right;">
-0.02
</td>
<td style="text-align:right;border-right:1px solid;">
0.04
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;border-right:1px solid;">
0.00
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;border-right:1px solid;">
0.01
</td>
</tr>
<tr>
<td style="text-align:right;border-right:1px solid;">
5
</td>
<td style="text-align:right;">
0.57
</td>
<td style="text-align:right;border-right:1px solid;">
0.62
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;border-right:1px solid;border-right:1px solid;">
0
</td>
<td style="text-align:right;">
0.58
</td>
<td style="text-align:right;border-right:1px solid;">
0.64
</td>
<td style="text-align:right;">
-0.04
</td>
<td style="text-align:right;">
0.03
</td>
<td style="text-align:right;">
0.03
</td>
<td style="text-align:right;border-right:1px solid;">
-0.02
</td>
<td style="text-align:right;">
0.02
</td>
<td style="text-align:right;border-right:1px solid;">
0.02
</td>
<td style="text-align:right;">
-0.04
</td>
<td style="text-align:right;border-right:1px solid;">
0.03
</td>
</tr>
<tr>
<td style="text-align:right;border-right:1px solid;">
6
</td>
<td style="text-align:right;">
0.63
</td>
<td style="text-align:right;border-right:1px solid;">
0.72
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;border-right:1px solid;border-right:1px solid;">
0
</td>
<td style="text-align:right;">
0.63
</td>
<td style="text-align:right;border-right:1px solid;">
0.71
</td>
<td style="text-align:right;">
-0.01
</td>
<td style="text-align:right;">
-0.01
</td>
<td style="text-align:right;">
0.01
</td>
<td style="text-align:right;border-right:1px solid;">
-0.01
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;border-right:1px solid;">
-0.01
</td>
<td style="text-align:right;">
-0.01
</td>
<td style="text-align:right;border-right:1px solid;">
-0.01
</td>
</tr>
<tr>
<td style="text-align:right;border-right:1px solid;">
7
</td>
<td style="text-align:right;">
0.73
</td>
<td style="text-align:right;border-right:1px solid;">
0.61
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;border-right:1px solid;border-right:1px solid;">
0
</td>
<td style="text-align:right;">
0.73
</td>
<td style="text-align:right;border-right:1px solid;">
0.62
</td>
<td style="text-align:right;">
0.01
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.01
</td>
<td style="text-align:right;border-right:1px solid;">
0.00
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;border-right:1px solid;">
0.01
</td>
<td style="text-align:right;">
0.01
</td>
<td style="text-align:right;border-right:1px solid;">
0.00
</td>
</tr>
<tr>
<td style="text-align:right;border-right:1px solid;">
8
</td>
<td style="text-align:right;">
0.58
</td>
<td style="text-align:right;border-right:1px solid;">
0.76
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;border-right:1px solid;border-right:1px solid;">
0
</td>
<td style="text-align:right;">
0.58
</td>
<td style="text-align:right;border-right:1px solid;">
0.76
</td>
<td style="text-align:right;">
-0.01
</td>
<td style="text-align:right;">
0.01
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;border-right:1px solid;">
-0.02
</td>
<td style="text-align:right;">
0.01
</td>
<td style="text-align:right;border-right:1px solid;">
0.00
</td>
<td style="text-align:right;">
-0.01
</td>
<td style="text-align:right;border-right:1px solid;">
0.01
</td>
</tr>
<tr>
<td style="text-align:right;border-right:1px solid;">
9
</td>
<td style="text-align:right;">
0.88
</td>
<td style="text-align:right;border-right:1px solid;">
0.50
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;border-right:1px solid;border-right:1px solid;">
0
</td>
<td style="text-align:right;">
0.87
</td>
<td style="text-align:right;border-right:1px solid;">
0.50
</td>
<td style="text-align:right;">
-0.01
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.03
</td>
<td style="text-align:right;border-right:1px solid;">
0.02
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;border-right:1px solid;">
0.00
</td>
<td style="text-align:right;">
-0.01
</td>
<td style="text-align:right;border-right:1px solid;">
0.00
</td>
</tr>
<tr>
<td style="text-align:right;border-right:1px solid;">
10
</td>
<td style="text-align:right;">
0.81
</td>
<td style="text-align:right;border-right:1px solid;">
0.57
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;border-right:1px solid;border-right:1px solid;">
0
</td>
<td style="text-align:right;">
0.80
</td>
<td style="text-align:right;border-right:1px solid;">
0.56
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
-0.03
</td>
<td style="text-align:right;">
-0.02
</td>
<td style="text-align:right;border-right:1px solid;">
0.02
</td>
<td style="text-align:right;">
-0.02
</td>
<td style="text-align:right;border-right:1px solid;">
-0.01
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;border-right:1px solid;">
-0.03
</td>
</tr>
<tr>
<td style="text-align:right;border-right:1px solid;">
11
</td>
<td style="text-align:right;">
0.75
</td>
<td style="text-align:right;border-right:1px solid;">
0.81
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;border-right:1px solid;border-right:1px solid;">
0
</td>
<td style="text-align:right;">
0.74
</td>
<td style="text-align:right;border-right:1px solid;">
0.81
</td>
<td style="text-align:right;">
0.01
</td>
<td style="text-align:right;">
0.01
</td>
<td style="text-align:right;">
0.03
</td>
<td style="text-align:right;border-right:1px solid;">
0.11
</td>
<td style="text-align:right;">
-0.01
</td>
<td style="text-align:right;border-right:1px solid;">
0.00
</td>
<td style="text-align:right;">
0.01
</td>
<td style="text-align:right;border-right:1px solid;">
0.01
</td>
</tr>
<tr>
<td style="text-align:right;border-right:1px solid;">
12
</td>
<td style="text-align:right;">
0.57
</td>
<td style="text-align:right;border-right:1px solid;">
0.86
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;border-right:1px solid;border-right:1px solid;">
0
</td>
<td style="text-align:right;">
0.57
</td>
<td style="text-align:right;border-right:1px solid;">
0.87
</td>
<td style="text-align:right;">
-0.02
</td>
<td style="text-align:right;">
-0.01
</td>
<td style="text-align:right;">
0.01
</td>
<td style="text-align:right;border-right:1px solid;">
-0.01
</td>
<td style="text-align:right;">
0.01
</td>
<td style="text-align:right;border-right:1px solid;">
0.01
</td>
<td style="text-align:right;">
-0.02
</td>
<td style="text-align:right;border-right:1px solid;">
-0.01
</td>
</tr>
<tr>
<td style="text-align:right;border-right:1px solid;">
13
</td>
<td style="text-align:right;">
0.94
</td>
<td style="text-align:right;border-right:1px solid;">
0.63
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;border-right:1px solid;border-right:1px solid;">
0
</td>
<td style="text-align:right;">
0.94
</td>
<td style="text-align:right;border-right:1px solid;">
0.64
</td>
<td style="text-align:right;">
-0.01
</td>
<td style="text-align:right;">
0.01
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;border-right:1px solid;">
-0.03
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;border-right:1px solid;">
0.01
</td>
<td style="text-align:right;">
-0.01
</td>
<td style="text-align:right;border-right:1px solid;">
0.01
</td>
</tr>
<tr>
<td style="text-align:right;border-right:1px solid;">
14
</td>
<td style="text-align:right;">
0.76
</td>
<td style="text-align:right;border-right:1px solid;">
0.79
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;border-right:1px solid;border-right:1px solid;">
0
</td>
<td style="text-align:right;">
0.76
</td>
<td style="text-align:right;border-right:1px solid;">
0.78
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.06
</td>
<td style="text-align:right;border-right:1px solid;">
0.06
</td>
<td style="text-align:right;">
0.01
</td>
<td style="text-align:right;border-right:1px solid;">
-0.01
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;border-right:1px solid;">
0.00
</td>
</tr>
<tr>
<td style="text-align:right;border-right:1px solid;">
15
</td>
<td style="text-align:right;">
0.50
</td>
<td style="text-align:right;border-right:1px solid;">
0.58
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;border-right:1px solid;border-right:1px solid;">
0
</td>
<td style="text-align:right;">
0.51
</td>
<td style="text-align:right;border-right:1px solid;">
0.59
</td>
<td style="text-align:right;">
-0.06
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
0.02
</td>
<td style="text-align:right;border-right:1px solid;">
-0.01
</td>
<td style="text-align:right;">
0.01
</td>
<td style="text-align:right;border-right:1px solid;">
0.02
</td>
<td style="text-align:right;">
-0.06
</td>
<td style="text-align:right;border-right:1px solid;">
0.05
</td>
</tr>
<tr>
<td style="text-align:right;border-right:1px solid;">
16
</td>
<td style="text-align:right;">
0.61
</td>
<td style="text-align:right;border-right:1px solid;">
0.57
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;border-right:1px solid;border-right:1px solid;">
0
</td>
<td style="text-align:right;">
0.61
</td>
<td style="text-align:right;border-right:1px solid;">
0.56
</td>
<td style="text-align:right;">
-0.01
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
-0.03
</td>
<td style="text-align:right;border-right:1px solid;">
0.01
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;border-right:1px solid;">
0.00
</td>
<td style="text-align:right;">
-0.01
</td>
<td style="text-align:right;border-right:1px solid;">
0.00
</td>
</tr>
<tr>
<td style="text-align:right;border-right:1px solid;">
17
</td>
<td style="text-align:right;">
0.85
</td>
<td style="text-align:right;border-right:1px solid;">
0.85
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;border-right:1px solid;border-right:1px solid;">
0
</td>
<td style="text-align:right;">
0.84
</td>
<td style="text-align:right;border-right:1px solid;">
0.86
</td>
<td style="text-align:right;">
-0.01
</td>
<td style="text-align:right;">
0.01
</td>
<td style="text-align:right;">
0.01
</td>
<td style="text-align:right;border-right:1px solid;">
0.01
</td>
<td style="text-align:right;">
-0.01
</td>
<td style="text-align:right;border-right:1px solid;">
0.00
</td>
<td style="text-align:right;">
-0.01
</td>
<td style="text-align:right;border-right:1px solid;">
0.01
</td>
</tr>
<tr>
<td style="text-align:right;border-right:1px solid;">
18
</td>
<td style="text-align:right;">
0.86
</td>
<td style="text-align:right;border-right:1px solid;">
0.88
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;border-right:1px solid;border-right:1px solid;">
0
</td>
<td style="text-align:right;">
0.85
</td>
<td style="text-align:right;border-right:1px solid;">
0.87
</td>
<td style="text-align:right;">
0.01
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.11
</td>
<td style="text-align:right;border-right:1px solid;">
0.00
</td>
<td style="text-align:right;">
-0.01
</td>
<td style="text-align:right;border-right:1px solid;">
-0.01
</td>
<td style="text-align:right;">
0.01
</td>
<td style="text-align:right;border-right:1px solid;">
0.00
</td>
</tr>
<tr>
<td style="text-align:right;border-right:1px solid;">
19
</td>
<td style="text-align:right;">
0.72
</td>
<td style="text-align:right;border-right:1px solid;">
0.75
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;border-right:1px solid;border-right:1px solid;">
0
</td>
<td style="text-align:right;">
0.72
</td>
<td style="text-align:right;border-right:1px solid;">
0.75
</td>
<td style="text-align:right;">
-0.01
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
-0.01
</td>
<td style="text-align:right;border-right:1px solid;">
-0.03
</td>
<td style="text-align:right;">
0.01
</td>
<td style="text-align:right;border-right:1px solid;">
-0.01
</td>
<td style="text-align:right;">
-0.01
</td>
<td style="text-align:right;border-right:1px solid;">
0.00
</td>
</tr>
<tr>
<td style="text-align:right;border-right:1px solid;">
20
</td>
<td style="text-align:right;">
0.76
</td>
<td style="text-align:right;border-right:1px solid;">
0.73
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;border-right:1px solid;border-right:1px solid;">
0
</td>
<td style="text-align:right;">
0.78
</td>
<td style="text-align:right;border-right:1px solid;">
0.74
</td>
<td style="text-align:right;">
-0.01
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.04
</td>
<td style="text-align:right;border-right:1px solid;">
-0.01
</td>
<td style="text-align:right;">
0.02
</td>
<td style="text-align:right;border-right:1px solid;">
0.01
</td>
<td style="text-align:right;">
-0.01
</td>
<td style="text-align:right;border-right:1px solid;">
0.00
</td>
</tr>
<tr>
<td style="text-align:right;border-right:1px solid;">
21
</td>
<td style="text-align:right;">
0.70
</td>
<td style="text-align:right;border-right:1px solid;">
0.94
</td>
<td style="text-align:right;">
0.82
</td>
<td style="text-align:right;">
0.43
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;border-right:1px solid;border-right:1px solid;">
0
</td>
<td style="text-align:right;">
0.70
</td>
<td style="text-align:right;border-right:1px solid;">
0.93
</td>
<td style="text-align:right;">
0.82
</td>
<td style="text-align:right;">
0.43
</td>
<td style="text-align:right;">
0.01
</td>
<td style="text-align:right;border-right:1px solid;">
0.14
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;border-right:1px solid;">
-0.01
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;border-right:1px solid;">
-0.01
</td>
</tr>
<tr>
<td style="text-align:right;border-right:1px solid;">
22
</td>
<td style="text-align:right;">
0.81
</td>
<td style="text-align:right;border-right:1px solid;">
0.76
</td>
<td style="text-align:right;">
-0.26
</td>
<td style="text-align:right;">
0.18
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;border-right:1px solid;border-right:1px solid;">
0
</td>
<td style="text-align:right;">
0.82
</td>
<td style="text-align:right;border-right:1px solid;">
0.75
</td>
<td style="text-align:right;">
-0.27
</td>
<td style="text-align:right;">
0.18
</td>
<td style="text-align:right;">
-0.03
</td>
<td style="text-align:right;border-right:1px solid;">
0.11
</td>
<td style="text-align:right;">
0.01
</td>
<td style="text-align:right;border-right:1px solid;">
-0.01
</td>
<td style="text-align:right;">
-0.01
</td>
<td style="text-align:right;border-right:1px solid;">
0.01
</td>
</tr>
<tr>
<td style="text-align:right;border-right:1px solid;">
23
</td>
<td style="text-align:right;">
0.79
</td>
<td style="text-align:right;border-right:1px solid;">
0.81
</td>
<td style="text-align:right;">
0.40
</td>
<td style="text-align:right;">
0.59
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;border-right:1px solid;border-right:1px solid;">
0
</td>
<td style="text-align:right;">
0.78
</td>
<td style="text-align:right;border-right:1px solid;">
0.82
</td>
<td style="text-align:right;">
0.41
</td>
<td style="text-align:right;">
0.58
</td>
<td style="text-align:right;">
-0.01
</td>
<td style="text-align:right;border-right:1px solid;">
-0.02
</td>
<td style="text-align:right;">
-0.01
</td>
<td style="text-align:right;border-right:1px solid;">
0.00
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;border-right:1px solid;">
-0.01
</td>
</tr>
<tr>
<td style="text-align:right;border-right:1px solid;">
24
</td>
<td style="text-align:right;">
0.62
</td>
<td style="text-align:right;border-right:1px solid;">
0.70
</td>
<td style="text-align:right;">
-0.21
</td>
<td style="text-align:right;">
0.03
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;border-right:1px solid;border-right:1px solid;">
0
</td>
<td style="text-align:right;">
0.63
</td>
<td style="text-align:right;border-right:1px solid;">
0.71
</td>
<td style="text-align:right;">
-0.21
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
-0.03
</td>
<td style="text-align:right;border-right:1px solid;">
-0.03
</td>
<td style="text-align:right;">
0.01
</td>
<td style="text-align:right;border-right:1px solid;">
0.01
</td>
<td style="text-align:right;">
-0.01
</td>
<td style="text-align:right;border-right:1px solid;">
0.02
</td>
</tr>
<tr>
<td style="text-align:right;border-right:1px solid;">
25
</td>
<td style="text-align:right;">
0.57
</td>
<td style="text-align:right;border-right:1px solid;">
0.62
</td>
<td style="text-align:right;">
0.16
</td>
<td style="text-align:right;">
0.95
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;border-right:1px solid;border-right:1px solid;">
0
</td>
<td style="text-align:right;">
0.56
</td>
<td style="text-align:right;border-right:1px solid;">
0.63
</td>
<td style="text-align:right;">
0.16
</td>
<td style="text-align:right;">
0.97
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;border-right:1px solid;">
0.01
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;border-right:1px solid;">
0.01
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;border-right:1px solid;">
0.02
</td>
</tr>
<tr>
<td style="text-align:right;border-right:1px solid;">
26
</td>
<td style="text-align:right;">
0.63
</td>
<td style="text-align:right;border-right:1px solid;">
0.72
</td>
<td style="text-align:right;">
0.95
</td>
<td style="text-align:right;">
0.16
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;border-right:1px solid;border-right:1px solid;">
0
</td>
<td style="text-align:right;">
0.63
</td>
<td style="text-align:right;border-right:1px solid;">
0.71
</td>
<td style="text-align:right;">
0.97
</td>
<td style="text-align:right;">
0.15
</td>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;border-right:1px solid;">
-0.02
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;border-right:1px solid;">
-0.01
</td>
<td style="text-align:right;">
0.01
</td>
<td style="text-align:right;border-right:1px solid;">
-0.01
</td>
</tr>
<tr>
<td style="text-align:right;border-right:1px solid;">
27
</td>
<td style="text-align:right;">
0.73
</td>
<td style="text-align:right;border-right:1px solid;">
0.61
</td>
<td style="text-align:right;">
0.75
</td>
<td style="text-align:right;">
0.63
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;border-right:1px solid;border-right:1px solid;">
0
</td>
<td style="text-align:right;">
0.73
</td>
<td style="text-align:right;border-right:1px solid;">
0.61
</td>
<td style="text-align:right;">
0.75
</td>
<td style="text-align:right;">
0.64
</td>
<td style="text-align:right;">
-0.01
</td>
<td style="text-align:right;border-right:1px solid;">
0.00
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;border-right:1px solid;">
0.00
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;border-right:1px solid;">
0.00
</td>
</tr>
<tr>
<td style="text-align:right;border-right:1px solid;">
28
</td>
<td style="text-align:right;">
0.58
</td>
<td style="text-align:right;border-right:1px solid;">
0.76
</td>
<td style="text-align:right;">
1.15
</td>
<td style="text-align:right;">
-0.21
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;border-right:1px solid;border-right:1px solid;">
0
</td>
<td style="text-align:right;">
0.58
</td>
<td style="text-align:right;border-right:1px solid;">
0.75
</td>
<td style="text-align:right;">
1.15
</td>
<td style="text-align:right;">
-0.20
</td>
<td style="text-align:right;">
-0.02
</td>
<td style="text-align:right;border-right:1px solid;">
0.08
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;border-right:1px solid;">
-0.01
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;border-right:1px solid;">
0.00
</td>
</tr>
<tr>
<td style="text-align:right;border-right:1px solid;">
29
</td>
<td style="text-align:right;">
0.88
</td>
<td style="text-align:right;border-right:1px solid;">
0.50
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
0.73
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;border-right:1px solid;border-right:1px solid;">
0
</td>
<td style="text-align:right;">
0.87
</td>
<td style="text-align:right;border-right:1px solid;">
0.50
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
0.72
</td>
<td style="text-align:right;">
0.01
</td>
<td style="text-align:right;border-right:1px solid;">
0.03
</td>
<td style="text-align:right;">
-0.01
</td>
<td style="text-align:right;border-right:1px solid;">
0.00
</td>
<td style="text-align:right;">
0.01
</td>
<td style="text-align:right;border-right:1px solid;">
-0.01
</td>
</tr>
<tr>
<td style="text-align:right;border-right:1px solid;">
30
</td>
<td style="text-align:right;">
0.81
</td>
<td style="text-align:right;border-right:1px solid;">
0.57
</td>
<td style="text-align:right;">
0.34
</td>
<td style="text-align:right;">
0.34
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;border-right:1px solid;border-right:1px solid;">
0
</td>
<td style="text-align:right;">
0.82
</td>
<td style="text-align:right;border-right:1px solid;">
0.56
</td>
<td style="text-align:right;">
0.35
</td>
<td style="text-align:right;">
0.31
</td>
<td style="text-align:right;">
0.07
</td>
<td style="text-align:right;border-right:1px solid;">
-0.03
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;border-right:1px solid;">
0.00
</td>
<td style="text-align:right;">
0.01
</td>
<td style="text-align:right;border-right:1px solid;">
-0.03
</td>
</tr>
<tr>
<td style="text-align:right;border-right:1px solid;">
31
</td>
<td style="text-align:right;">
0.75
</td>
<td style="text-align:right;border-right:1px solid;">
0.81
</td>
<td style="text-align:right;">
0.03
</td>
<td style="text-align:right;">
1.15
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;border-right:1px solid;border-right:1px solid;">
0
</td>
<td style="text-align:right;">
0.75
</td>
<td style="text-align:right;border-right:1px solid;">
0.81
</td>
<td style="text-align:right;">
0.03
</td>
<td style="text-align:right;">
1.14
</td>
<td style="text-align:right;">
0.01
</td>
<td style="text-align:right;border-right:1px solid;">
0.05
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;border-right:1px solid;">
0.00
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;border-right:1px solid;">
-0.01
</td>
</tr>
<tr>
<td style="text-align:right;border-right:1px solid;">
32
</td>
<td style="text-align:right;">
0.57
</td>
<td style="text-align:right;border-right:1px solid;">
0.86
</td>
<td style="text-align:right;">
0.73
</td>
<td style="text-align:right;">
0.15
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;border-right:1px solid;border-right:1px solid;">
0
</td>
<td style="text-align:right;">
0.56
</td>
<td style="text-align:right;border-right:1px solid;">
0.86
</td>
<td style="text-align:right;">
0.73
</td>
<td style="text-align:right;">
0.16
</td>
<td style="text-align:right;">
-0.03
</td>
<td style="text-align:right;border-right:1px solid;">
-0.09
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;border-right:1px solid;">
0.00
</td>
<td style="text-align:right;">
0.01
</td>
<td style="text-align:right;border-right:1px solid;">
0.02
</td>
</tr>
<tr>
<td style="text-align:right;border-right:1px solid;">
33
</td>
<td style="text-align:right;">
0.94
</td>
<td style="text-align:right;border-right:1px solid;">
0.63
</td>
<td style="text-align:right;">
0.59
</td>
<td style="text-align:right;">
0.75
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;border-right:1px solid;border-right:1px solid;">
0
</td>
<td style="text-align:right;">
0.94
</td>
<td style="text-align:right;border-right:1px solid;">
0.63
</td>
<td style="text-align:right;">
0.57
</td>
<td style="text-align:right;">
0.75
</td>
<td style="text-align:right;">
0.11
</td>
<td style="text-align:right;border-right:1px solid;">
0.03
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;border-right:1px solid;">
0.00
</td>
<td style="text-align:right;">
-0.02
</td>
<td style="text-align:right;border-right:1px solid;">
0.01
</td>
</tr>
<tr>
<td style="text-align:right;border-right:1px solid;">
34
</td>
<td style="text-align:right;">
0.76
</td>
<td style="text-align:right;border-right:1px solid;">
0.79
</td>
<td style="text-align:right;">
0.15
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;border-right:1px solid;border-right:1px solid;">
0
</td>
<td style="text-align:right;">
0.74
</td>
<td style="text-align:right;border-right:1px solid;">
0.80
</td>
<td style="text-align:right;">
0.15
</td>
<td style="text-align:right;">
1.01
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;border-right:1px solid;">
0.05
</td>
<td style="text-align:right;">
-0.02
</td>
<td style="text-align:right;border-right:1px solid;">
0.01
</td>
<td style="text-align:right;">
0.01
</td>
<td style="text-align:right;border-right:1px solid;">
0.01
</td>
</tr>
<tr>
<td style="text-align:right;border-right:1px solid;">
35
</td>
<td style="text-align:right;">
0.50
</td>
<td style="text-align:right;border-right:1px solid;">
0.58
</td>
<td style="text-align:right;">
0.73
</td>
<td style="text-align:right;">
0.34
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;border-right:1px solid;border-right:1px solid;">
0
</td>
<td style="text-align:right;">
0.50
</td>
<td style="text-align:right;border-right:1px solid;">
0.57
</td>
<td style="text-align:right;">
0.72
</td>
<td style="text-align:right;">
0.34
</td>
<td style="text-align:right;">
-0.01
</td>
<td style="text-align:right;border-right:1px solid;">
0.04
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;border-right:1px solid;">
0.00
</td>
<td style="text-align:right;">
-0.01
</td>
<td style="text-align:right;border-right:1px solid;">
0.00
</td>
</tr>
<tr>
<td style="text-align:right;border-right:1px solid;">
36
</td>
<td style="text-align:right;">
0.61
</td>
<td style="text-align:right;border-right:1px solid;">
0.57
</td>
<td style="text-align:right;">
0.43
</td>
<td style="text-align:right;">
-0.26
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;border-right:1px solid;border-right:1px solid;">
0
</td>
<td style="text-align:right;">
0.62
</td>
<td style="text-align:right;border-right:1px solid;">
0.56
</td>
<td style="text-align:right;">
0.42
</td>
<td style="text-align:right;">
-0.29
</td>
<td style="text-align:right;">
0.04
</td>
<td style="text-align:right;border-right:1px solid;">
0.01
</td>
<td style="text-align:right;">
0.01
</td>
<td style="text-align:right;border-right:1px solid;">
0.00
</td>
<td style="text-align:right;">
-0.02
</td>
<td style="text-align:right;border-right:1px solid;">
-0.02
</td>
</tr>
<tr>
<td style="text-align:right;border-right:1px solid;">
37
</td>
<td style="text-align:right;">
0.85
</td>
<td style="text-align:right;border-right:1px solid;">
0.85
</td>
<td style="text-align:right;">
0.18
</td>
<td style="text-align:right;">
0.52
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;border-right:1px solid;border-right:1px solid;">
0
</td>
<td style="text-align:right;">
0.86
</td>
<td style="text-align:right;border-right:1px solid;">
0.86
</td>
<td style="text-align:right;">
0.18
</td>
<td style="text-align:right;">
0.53
</td>
<td style="text-align:right;">
0.10
</td>
<td style="text-align:right;border-right:1px solid;">
0.13
</td>
<td style="text-align:right;">
0.01
</td>
<td style="text-align:right;border-right:1px solid;">
0.01
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;border-right:1px solid;">
0.00
</td>
</tr>
<tr>
<td style="text-align:right;border-right:1px solid;">
38
</td>
<td style="text-align:right;">
0.86
</td>
<td style="text-align:right;border-right:1px solid;">
0.88
</td>
<td style="text-align:right;">
0.52
</td>
<td style="text-align:right;">
0.40
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;border-right:1px solid;border-right:1px solid;">
0
</td>
<td style="text-align:right;">
0.86
</td>
<td style="text-align:right;border-right:1px solid;">
0.88
</td>
<td style="text-align:right;">
0.51
</td>
<td style="text-align:right;">
0.41
</td>
<td style="text-align:right;">
0.07
</td>
<td style="text-align:right;border-right:1px solid;">
0.09
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;border-right:1px solid;">
0.01
</td>
<td style="text-align:right;">
-0.01
</td>
<td style="text-align:right;border-right:1px solid;">
0.01
</td>
</tr>
<tr>
<td style="text-align:right;border-right:1px solid;">
39
</td>
<td style="text-align:right;">
0.72
</td>
<td style="text-align:right;border-right:1px solid;">
0.75
</td>
<td style="text-align:right;">
0.63
</td>
<td style="text-align:right;">
0.73
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;border-right:1px solid;border-right:1px solid;">
0
</td>
<td style="text-align:right;">
0.71
</td>
<td style="text-align:right;border-right:1px solid;">
0.76
</td>
<td style="text-align:right;">
0.63
</td>
<td style="text-align:right;">
0.73
</td>
<td style="text-align:right;">
0.06
</td>
<td style="text-align:right;border-right:1px solid;">
0.06
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;border-right:1px solid;">
0.01
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;border-right:1px solid;">
0.00
</td>
</tr>
<tr>
<td style="text-align:right;border-right:1px solid;">
40
</td>
<td style="text-align:right;">
0.76
</td>
<td style="text-align:right;border-right:1px solid;">
0.73
</td>
<td style="text-align:right;">
0.34
</td>
<td style="text-align:right;">
0.82
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;border-right:1px solid;border-right:1px solid;">
0
</td>
<td style="text-align:right;">
0.76
</td>
<td style="text-align:right;border-right:1px solid;">
0.72
</td>
<td style="text-align:right;">
0.34
</td>
<td style="text-align:right;">
0.82
</td>
<td style="text-align:right;">
-0.06
</td>
<td style="text-align:right;border-right:1px solid;">
0.02
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;border-right:1px solid;">
-0.01
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;border-right:1px solid;">
0.00
</td>
</tr>
</tbody>
</table></div>
<p>Table <a href="chapTappers1.html#tab:chapTappers13ODEfittedParametersKDTable">7.6</a> contains an overview of the
errors between designed and estimated parameters.
For K parameters the mean of the absolute value of the errors is 0.01 and its standard deviation is 0.01, suggesting that the error is about 1% of the coupling strength (given the interval <span class="math inline">\([0,1]\)</span>).
For D parameters the error is about <span class="math inline">\(100* .045 / (2\pi) = 0.7 \%\)</span> of the phase delay (having the interval <span class="math inline">\([-\pi,+\pi]\)</span>).</p>
<div class="inline-table"><table class="table table-striped" style="font-size: 10px; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">
<span id="tab:chapTappers13ODEfittedParametersKDTable">Table 7.6: </span>Mean of absolute value of errors, standard deviation of absolute errors, and Q95 range of between designed and estimated compling strength K and phase deley D, without and with designed phase delay
</caption>
<thead><tr>
<th style="text-align:right;">
m_abs
</th>
<th style="text-align:right;">
sd_abs
</th>
<th style="text-align:right;">
Q95.l
</th>
<th style="text-align:right;">
Q95.u
</th>
<th style="text-align:left;">
phasedelay
</th>
<th style="text-align:left;">
parameter
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:right;">
0.01
</td>
<td style="text-align:right;">
0.01
</td>
<td style="text-align:right;">
-0.03
</td>
<td style="text-align:right;">
0.02
</td>
<td style="text-align:left;">
No
</td>
<td style="text-align:left;">
K
</td>
</tr>
<tr>
<td style="text-align:right;">
0.01
</td>
<td style="text-align:right;">
0.01
</td>
<td style="text-align:right;">
-0.02
</td>
<td style="text-align:right;">
0.04
</td>
<td style="text-align:left;">
Yes
</td>
<td style="text-align:left;">
K
</td>
</tr>
<tr>
<td style="text-align:right;">
0.04
</td>
<td style="text-align:right;">
0.07
</td>
<td style="text-align:right;">
-0.09
</td>
<td style="text-align:right;">
0.16
</td>
<td style="text-align:left;">
No
</td>
<td style="text-align:left;">
D
</td>
</tr>
<tr>
<td style="text-align:right;">
0.05
</td>
<td style="text-align:right;">
0.06
</td>
<td style="text-align:right;">
-0.15
</td>
<td style="text-align:right;">
0.16
</td>
<td style="text-align:left;">
Yes
</td>
<td style="text-align:left;">
D
</td>
</tr>
</tbody>
</table></div>
<p>Overall, it can be concluded that state-space modelling is very successful in retrieving the parameters from simulated observations.</p>
</div>
<div id="evaluating-the-posterior-predictions" class="section level3 unnumbered">
<h3>Evaluating the posterior predictions<a class="anchor" aria-label="anchor" href="#evaluating-the-posterior-predictions"><i class="fas fa-link"></i></a>
</h3>
<p>Here we look at the posterior predictions, that is, the observations generated by the state-space model. We show the relative phase and the instantaneous period of defined and fitted states and observations.
This comparison is qualitative.
Below are examples for model 1 and 21.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:chapTappers16simFinal"></span>
<img src="Figures/chapTappers_StateSpaceModel_PosteriorPredictions_Relphase_model_1.png" alt="Dynamic system 1. Top: Defined discrete observations (circles) versus fitted observatins (gray band). Bottom: Instantaneous period of the defined states and fitted states" width="75%"><img src="Figures/chapTappers_StateSpaceModel_PosteriorPredictions_InstPeriod_model_1.png" alt="Dynamic system 1. Top: Defined discrete observations (circles) versus fitted observatins (gray band). Bottom: Instantaneous period of the defined states and fitted states" width="75%"><p class="caption">
Figure 7.13: Dynamic system 1. Top: Defined discrete observations (circles) versus fitted observatins (gray band). Bottom: Instantaneous period of the defined states and fitted states
</p>
</div>
<p>It’s important to understand that the fitted observations are continuous. They are generated without considering discrete time. Starting from states, we just add the random noise from the observation equation. Therefore, the result is a band (CI-95%) around the curve showing the states, rather than discrete events. In the bottom figure, this same curve is then shown as instantaneous period, together with the designed instantaneous period. It gives a view on the states.</p>
<div class="figure" style="text-align: center">
<span style="display:block;" id="fig:chapTappers16simFinal21"></span>
<img src="Figures/chapTappers_StateSpaceModel_PosteriorPredictions_Relphase_model_21.png" alt="Dynamic system 21. Top: Defined discrete observations (circles) versus fitted observatins (gray band). Bottom: Instantaneous period of the defined states and fitted states" width="75%"><img src="Figures/chapTappers_StateSpaceModel_PosteriorPredictions_InstPeriod_model_21.png" alt="Dynamic system 21. Top: Defined discrete observations (circles) versus fitted observatins (gray band). Bottom: Instantaneous period of the defined states and fitted states" width="75%"><p class="caption">
Figure 7.14: Dynamic system 21. Top: Defined discrete observations (circles) versus fitted observatins (gray band). Bottom: Instantaneous period of the defined states and fitted states
</p>
</div>
</div>
</div>
<div id="discussion-2" class="section level2" number="7.5">
<h2>
<span class="header-section-number">7.5</span> Discussion<a class="anchor" aria-label="anchor" href="#discussion-2"><i class="fas fa-link"></i></a>
</h2>
<p>The error between <em>defined</em> and <em>estimated</em> coupling strength parameters is about 1% of the coupling strength scale, and there is no great difference in accuracy for coupling strengths with our without defined phase delay.</p>
<p>However, several limitations and shortcomings of the evaluation should be mentioned as well.</p>
<p>First, the dynamic system assumes that attention is either devoted to the own metronome heard or to the other subject seen. One may question whether it is realistic. Perhaps human subjects get distracted by other events outside the timing task. Exogeneous distraction is something that the model doesn’t capture.</p>
<p>Second, in the current model, the coupling strength is fixed over time but it could be that subjects change the coupling strength over time. The time series may be non-stationary when the subject’s variability changes over time.</p>
<p>Finally, the modelling needs to accurately reflect the physical setup. A slightly different paradigm for studying rhythmic entrainment (e.g. with spontaneous tapping without metronomes) could require a careful adaptation of the dynamic system defined in this chapter. In the next chapter, we’ll see that the eigen-frequency of the second metronome is not exactly 610 but 609.375, due to the experimental design to get 39 seconds for the outphasing-inphasing cycle (<span class="math inline">\((600 * 609.375/9.375) /1000 = 39\)</span>).</p>
<p>Overall, the dynamic model might be useful for real observations (i.e., tapping data from real subjects) but we have to keep in mind that some assumptions from our simulation could be very different in the real world. For example, subjects might be distracted and loose the synchrony all together.</p>
</div>
<div id="conclusion-5" class="section level2" number="7.6">
<h2>
<span class="header-section-number">7.6</span> Conclusion<a class="anchor" aria-label="anchor" href="#conclusion-5"><i class="fas fa-link"></i></a>
</h2>
<p>In this chapter we studied entrainment from a dynamic system’s perspective defined by network of timing units (metronomes and subjects). In these units, a phase flow can be described by a state-space model, with state equations and observation equation.
The state-space model can generate states from which it is possible to generate discrete observations, standing for tics and taps.
Once we have observations, the state-space model can be used for estimating parameters, and for generating new observations (continuous, rather than discrete).</p>
<p>We compared the designed parameters with the estimated parameters, and got a quantitative error estimate of 1%. Visual inspection of observations and states of state-space models confirm this close match.</p>
<p>Overall, this non-linear state-space model seems to offer a valuable tool for acquiring insight about rhythmic entrainment in terms of causal dyadic interactions at the level of a phase flow.</p>
<p><!-- Further research focusing on different experimental paradigms, and application of the ODE-regression model on human data has the potential to contribute to a deeper understanding of sensorimotor synchronization in music-dance (e.g. Talebi et al., 2023), motor rehabilitation (Moumdjian et al., 2022), and other forms of human expression and empowerment, including biofeedback systems (Leman, 2016). --></p>
<p><!-- ## References -->
<!-- (for a comprehensive overview, refer to Demos & Palmer, 2023) -->
<!-- (e.g. Heggli et al., 2019) Kuramoto models -->
<!-- (see Repp and Su (2012) for a review of finger tapping and anticipation -->
<!-- (e.g. McElreath, 2020, Gelman et al., 2013) -->
<!-- , see a number of blogs listed at the end of this chapter -->
<!-- (Rosso et al., 2021, 2023) --></p>

</div>
</div>

  <div class="chapter-nav">
<div class="prev"><a href="chapExoskeletons.html"><span class="header-section-number">6</span> Two violin players’ haptic feedback</a></div>
<div class="next"><a href="chapTappers2.html"><span class="header-section-number">8</span> Two finger tappers’ entrainment (Part 2)</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <h2>Provide your feedback</h2>
    <!--<p>Now is a great time to provide feedback</p>-->
        <ul class="list-unstyled">
<!--<li><a href="https://forms.gle/nq9RmbxJyZXQgc948">Provide feedback (5 min)</a></li>--><li><a href="https://www.ugent.be/lw/kunstwetenschappen/ipem/en/services/asil">art and science interaction lab</a></li>
        </ul>
<hr>
<nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#chapTappers1"><span class="header-section-number">7</span> Two finger tappers’ entrainment (Part 1)</a></li>
<li>
<a class="nav-link" href="#theory-3"><span class="header-section-number">7.1</span> Theory</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#entrainment-1">Entrainment</a></li>
<li><a class="nav-link" href="#dynamic-system">Dynamic system</a></li>
<li><a class="nav-link" href="#drifting-metronomes">Drifting metronomes</a></li>
<li><a class="nav-link" href="#causality">Causality</a></li>
<li><a class="nav-link" href="#approach-in-this-chapter">Approach in this chapter</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#step1.-from-model-to-observations"><span class="header-section-number">7.2</span> Step1. From model to observations</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#define-the-units">Define the units</a></li>
<li><a class="nav-link" href="#coupling-parameters">Coupling parameters</a></li>
<li><a class="nav-link" href="#state-equations">State equations</a></li>
<li><a class="nav-link" href="#understanding-the-dynamic">Understanding the dynamic</a></li>
<li><a class="nav-link" href="#general-specification">General specification</a></li>
<li><a class="nav-link" href="#running-a-simulation-app">Running a simulation app</a></li>
<li><a class="nav-link" href="#generating-fake-observations">Generating fake observations</a></li>
<li><a class="nav-link" href="#constraints-in-parameters">Constraints in parameters</a></li>
<li><a class="nav-link" href="#generate-states">Generate states</a></li>
<li><a class="nav-link" href="#generate-observations">Generate observations</a></li>
<li><a class="nav-link" href="#examples">Examples</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#step-2.-from-observations-to-parameters-and-predictions"><span class="header-section-number">7.3</span> Step 2. From observations to parameters and predictions</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#observations">Observations</a></li>
<li><a class="nav-link" href="#likelihood-function">Likelihood function</a></li>
<li><a class="nav-link" href="#priors-for-likelihood-function">Priors for likelihood function</a></li>
<li><a class="nav-link" href="#running-stan"><span class="header-section-number">7.3.1</span> Running Stan</a></li>
<li><a class="nav-link" href="#state-equations-1">State equations</a></li>
<li><a class="nav-link" href="#posterior-predictions-or-generated-states-and-observations">Posterior predictions, or generated states and observations</a></li>
<li><a class="nav-link" href="#summary-stan-code">Summary Stan code</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#step-3.-evaluation"><span class="header-section-number">7.4</span> Step 3. Evaluation</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#evaluating-the-posterior-distributions">Evaluating the posterior distributions</a></li>
<li><a class="nav-link" href="#evaluating-the-posterior-predictions">Evaluating the posterior predictions</a></li>
</ul>
</li>
<li><a class="nav-link" href="#discussion-2"><span class="header-section-number">7.5</span> Discussion</a></li>
<li><a class="nav-link" href="#conclusion-5"><span class="header-section-number">7.6</span> Conclusion</a></li>
</ul>
      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/mlIpem/ExploringMusicInteractionWithR/blob/main/08_chapTappers.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/mlIpem/ExploringMusicInteractionWithR/edit/main/08_chapTappers.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Exploring music interactions</strong>" was written by Marc Leman. It was last built on 2024-12-19.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
